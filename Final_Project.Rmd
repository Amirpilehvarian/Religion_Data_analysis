---
title: "U.S. Religious Landscape Survey Analysis"
author: "Amirhossein Pilehvarian"
date: "2024-04-09"
output:
  html_document:
    css: "styles.css"
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: false
    fig_caption: true
    code_folding: show
    df_print: paged
    DT: datatable
    theme: united
    highlight: tango
editor_options: 
  chunk_output_type: inline
---


<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>





```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
```




!["The Last Judgment" by Michelangelo](title.jpg)




## Abstract

<br> 

Alexis de Tocqueville, a prominent French writer from the early 19th century who extensively studied democracy in America, recognized the significant influence religion has on American society. He observed that American civilization uniquely combines the spirit of religion and the spirit of liberty, blending them harmoniously.

Nearly two centuries later, religion continues to shape the beliefs and values of Americans. To explore the relationship between religious beliefs and social and political views, the Pew Research Center's Forum on Religion & Public Life conducted a comprehensive survey on religion in America. The first report, published in February 2008, examined the religious affiliations of the American public, as well as changes in affiliation and the diversity of religious traditions.

The latest release of the Landscape Survey provides detailed information on various aspects of religious beliefs and practices in America. This includes the importance of religion in people's lives, belief in God and the afterlife, worship attendance, and participation in religious activities. The study also investigates public opinion on religion's impact on society, conflicts between religion and society, and the relationship between religion and life satisfaction.

Using survey responses, the report analyzes the diversity of opinion on political and public policy issues among different religious groups in the United States, including those who are unaffiliated or nominally affiliated with a religious tradition. These issues range from ideological orientation to views on social issues, government size and role, environmental concerns, and foreign affairs.

The Landscape Survey is based on a nationwide survey conducted from May 8 to August 13, 2007, with over 35,000 adult participants. Additional oversampling was conducted for Eastern Orthodox Christians, Buddhists, and Hindus. The study also incorporates data from a 2007 survey of American Muslims, conducted in partnership with other Pew Research Center projects, resulting in interviews with over 36,000 Americans in total.

<br> 

## Keywords

<br> 

1. Religion in America
2. American civilization
3. Religious beliefs and practices
4. Social and political views
5. Diversity of religious traditions
6. Public opinion on religious impact
7. Political and public policy issues
8. Statistical modeling and analysis

<br> 

## Introduction

<br> 

I would like to divide this project into several chapters, in each chapter I'm gonna search for the answer of my own questions.

<br> 

### Chapter 1 (Religious Beliefs and Practices)

<br> 

**Question**: How do Americans' religious beliefs and practices vary across different demographic groups, and what insights can be gained by examining measures such as the importance of religion in people's lives, belief in God, frequency of prayer, and frequency of worship service attendance?

**Explanation**: This chapter delves into the diverse religious beliefs and practices of American adults. It begins by exploring the importance individuals attribute to religion in their lives and delves into their perspectives on God, Scripture, miracles, and other religious beliefs. Furthermore, it discusses worship and other congregational activities, as well as devotional practices and spiritual experiences. The chapter also addresses beliefs about religion, including exclusivity in claims to salvation and moral considerations. Along the way, four key measures of religious commitment – importance of religion in people's lives, belief in God, frequency of prayer, and frequency of worship service attendance – are highlighted for demographic analysis. These measures serve as lenses through which to examine social and political attitudes within religious traditions in subsequent chapters.

<br> 

### Chapter 2 (Social and Political Views)

<br> 

**Question**: How do Americans' religious affiliations and levels of religious commitment influence their views on social and political issues?

**Explanation**: This chapter delves into the relationship between Americans' religious affiliations, beliefs, practices, and their social and political attitudes. Despite religion being a secondary source for many, the analysis reveals strong correlations between religious affiliation, beliefs, and social attitudes.
<br> 

### Chapter 3 (The Changing Religious Trends)

<br> 

**Question**: What trends have emerged in the religious landscape of the United States in recent years, and how have they impacted the overall attitude of the population toward different subjects?

**Explanation**: This chapter examines the changing religious landscape and social attitudes in the United States over the past seven years. It explores shifts in religious affiliation, attitudes towards abortion, views on homosexuality, acceptance of evolution, and experiences of spiritual peace. With Christians declining in proportion and the rise of the religiously unaffiliated, societal attitudes have evolved, reflecting greater acceptance and diversity of beliefs. Through this analysis, we gain insight into the evolving dynamics of religion, morality, and personal values in American society.

<br> 

### Chapter 4 (Religious Switching and Intermarriage)

<br> 

**Question**: How can we model and understand the trends and dynamics of religious affiliation changes among American adults?

**Explanation**: In this revised chapter, our analysis shifts from a broad discussion of religious switching and intermarriage to a more focused examination of the factors influencing religious affiliation changes over time. Utilizing advanced statistical models, including decision trees and Generalized Linear Models (GLM), we delve into the intricacies of religious identity transitions from childhood to adulthood. By examining the predictive power of sociodemographic variables such as income, education, age, and marital status, our models shed light on the underlying patterns that guide religious affiliation changes. We explore the significance of these variables in contributing to an individual's likelihood of shifting religious identity, providing a nuanced understanding of the factors at play.



<br> 


## Data Description

<br>


### 2007 Religious Landscape Study

<br>

**Summary**: 
The 2007 U.S. Religious Landscape Study is a comprehensive telephone survey that explores the religious affiliations, beliefs, and practices of the American public. Conducted by the Pew Research Center, this survey provides insights into the religious composition of the U.S. and examines how religion intersects with various aspects of public life.

<br>

**Dataset Details**:

| **Aspect**             | **Details**                                                                                                                      |
|------------------------|----------------------------------------------------------------------------------------------------------------------------------|
| Survey Conducted By    | Pew Research Center                                                                                                              |
| Date of Survey         | 2007                                                                                                                             |
| Sample Size            | Over 35,000 U.S. Adults                                                                                                          |
| Methodology            | Telephone survey (landline and cellphones)                                                                                       |
| Geographic Coverage    | National (U.S.)                                                                                                                  |
| Population Coverage    | 97% of non-institutionalized U.S. adult population                                                                              |
| Non-Coverage           | 3% of U.S. adults not reachable by telephone or non-English/Spanish speakers                                                    |
| Data Availability      | Publicly available for analysis                                                                                                 |
| Funding                | The Pew Charitable Trusts, supported by Lilly Endowment Inc.                                                                     |
| Research Purpose       | To inform about religious affiliations, beliefs, and practices; and understand their influence on various aspects of public life |

<br>

### 2014 Religious Landscape Study

<br>

**Summary**: 
The 2014 Religious Landscape Study, following up on the initial 2007 survey, provides updated data on religious affiliations and the changing religious composition in the United States. This extensive survey captures current trends and shifts in religion within the American adult population.

<br>

**Dataset Details**:

| **Aspect**             | **Details**                                                                                                                      |
|------------------------|----------------------------------------------------------------------------------------------------------------------------------|
| Survey Conducted By    | Pew Research Center                                                                                                              |
| Date of Survey         | June 4 - Sept. 30, 2014                                                                                                          |
| Sample Size            | 35,071 U.S. Adults                                                                                                               |
| Methodology            | Telephone survey (60% cellphones, 40% landlines)                                                                                  |
| Geographic Coverage    | National (U.S.), with at least 300 interviews in every state and the District of Columbia                                        |
| Language               | English and Spanish                                                                                                              |
| Population Coverage    | 97% of non-institutionalized U.S. adult population                                                                              |
| Non-Coverage           | 3% of U.S. adults not reachable by telephone or non-English/Spanish speakers                                                    |
| Data Availability      | Publicly available for analysis                                                                                                 |
| Funding                | The Pew Charitable Trusts, supported by Lilly Endowment Inc.                                                                     |
| Research Purpose       | To provide insights into the religious beliefs and practices, as well as the social and political attitudes of the U.S. adults   |

These datasets are instrumental for analyzing changes over time in religious beliefs and practices among U.S. adults. They offer a wealth of information that can be utilized to study the relationship between religion and a variety of sociodemographic factors. The data is publicly available and provides a representative snapshot of the religious composition of the United States for the respective years.

<br>

## Chapter 1 : Religious Beliefs and Practices

<br> 

### Religion Composition

<br> 

This statistical breakdown provides a clear picture of the religious affiliations among survey respondents, focusing on those with more than 100 individuals per religion. It highlights the diversity of religious identities represented in the survey, including Agnostic, Atheist, Buddhist, Hindu, Jewish, Mormon, Muslim, Orthodox, Protestant, Roman Catholic, and others. The larger representation of categories like Protestant and Roman Catholic indicates their significant presence in the surveyed population. Additionally, the inclusion of categories such as "Nothing in particular", "Agnostic", "Atheist" underscores the prevalence of religious non-affiliation among respondents. Overall, this breakdown offers a straightforward overview of the religious diversity within the survey sample, facilitating further analysis of attitudes and beliefs across different religious affiliations.

<br> 

```{r , show_col_types=FALSE, warning=FALSE , message=FALSE}
# Load the necessary library
library(readr)
library(igraph)
library(ggraph)
library(colormap)
library(oce)
library(pROC)
library(ggplot2)
library(magrittr) # needs to be run every time you start R and want to use %>%
library(dplyr)    # alternatively, this also loads %>%
library(plotly)
library(kableExtra)
library(tidyr)
library(rpart)
library(randomForest)
library(caret)

# Load the dataset 2007
survey_data_2007 <- read_csv("Dataset_2007.csv")
# Load the dataset 2014
survey_data_2014 <- read_csv("Dataset_2014.csv")

```

<br> 


```{r, RELIGION COUNTS VISUALIZAION}

# Let's say we have the data frame 'survey_data'
survey_data <- data.frame(survey_data_2007$q16)


# Assuming 'q16' is the column for religion
religion_counts_2007 <- survey_data_2007 %>%
  count(q16) %>%
  filter(n > 100)

# Rename the columns for clarity
colnames(religion_counts_2007) <- c("Religion", "Respondents")

# Calculate the total number of respondents
total_respondents <- sum(religion_counts_2007$Respondents)

# Calculate percentages
religion_counts_2007 <- religion_counts_2007 %>%
  mutate(Percentage = (Respondents / total_respondents) * 100)

options(repr.plot.width = 8, repr.plot.height =5)
# Create the bar plot
p <- ggplot(religion_counts_2007, aes(x = reorder(Religion, -Percentage), y = Percentage, fill = Religion) , width = 60 , height = 12) + 
  geom_bar(stat = "identity") + # Use identity to use the heights of the bars as provided in the data frame
  coord_flip() +  # Flip coordinates to have horizontal bars
  theme_minimal() +  # Use a minimal theme for aesthetics
  labs(title = "Number of Respondents",
       x = "",
       y = "") +
  theme(legend.position = "none")  # Remove the legend


# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 500)

# Show the interactive plot in your default browser

interactive_plot
```







<br></br>
<br></br>
<br></br>


### Importance of Religion

<br> 

**Question:**

"How important is religion in your life?"


- **Very Important:** A significant proportion of respondents from various religious backgrounds, including Jehovah’s Witnesses, Mormons, Muslims, Orthodox Christians, Protestants, Roman Catholics, and Unitarians, consider religion to be highly important in their lives. These individuals prioritize religious beliefs and practices as integral aspects of their identity and worldview.

- **Somewhat Important:** Another sizable segment of respondents, spanning diverse religious groups such as Buddhists, Hindus, and those with no particular religious affiliation, view religion as somewhat important in their lives. While not as central as for those who consider it very important, these individuals still recognize the value of religious beliefs and traditions to some extent.

- **Not Too Important or Not at All Important:** A minority of respondents, particularly atheists and agnostics, express that religion holds little to no importance in their lives. They either do not believe in religious concepts or do not actively engage with religious practices, indicating a lack of significance of religion in shaping their personal identities or guiding their daily lives.



<br> 

```{r, RELLIGION VISUALIZATION}

religion_importance <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q21)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q21) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q21)



p <- ggplot(religion_importance, aes(x = q16, y = q21, fill = Percentage)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), axis.text.y = element_text(size = 12), title = element_text(size = 20)) +
  labs(title = "Percentage of Responses on the Importance of Religion by Religious Group",
       x = "Religion",
       y = "Importance",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

# Show the interactive plot in your default browser

interactive_plot



```


<br>

**Conclusion:**

The data underscores the diversity of attitudes toward religion among individuals of various religious affiliations. While some prioritize religion as a fundamental aspect of their lives, others assign varying degrees of importance to it, and some do not consider it significant at all. Understanding these perspectives is essential for appreciating the complex role that religion plays in shaping individual identities and societal dynamics.

<br>


```{r, RELIGION}



religion_importance_selected <- select(religion_importance, q16, q21, Percentage)


religion_importance_wide <- pivot_wider(
  religion_importance_selected,
  names_from = q21,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(religion_importance_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(religion_importance_wide, "html", align = c('l', rep('c', 10))) %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "How important is religion in your life" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table

```

<br>
<br>

#### Importance of Religion and Demographic Groups

<br>

The survey highlights a significant gender disparity regarding the importance of religion in individuals' lives, with women more likely than men to consider religion very important. This trend persists across various religious groups.

Furthermore, age plays a substantial role in determining the importance of religion, with older adults more likely than younger adults to prioritize it. For instance, less than half (45%) of adults under 30 view religion as very important, contrasting with over two-thirds (68%) of those aged 60 and older.

Regarding education, the survey indicates that individuals with lower levels of education tend to place greater importance on religion in their lives.

<br>

```{r, SEX}
religion_importance_gender <- survey_data_2007 %>%
  group_by(sex) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(sex), !is.na(q21)) %>%  # Ensure q16 and q21 are not NA
  group_by(sex, q21) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(sex) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(sex, q21)


religion_importance_gender_selected <- select(religion_importance_gender, sex, q21, Percentage)


religion_importance_gender_wide <- pivot_wider(
  religion_importance_gender_selected,
  names_from = q21,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(religion_importance_gender_wide)[1] <- "Sex"

# Create the table with kable and add styling with kableExtra
table <- kable(religion_importance_gender_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "How important is religion in your life" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```


<br>
<br>

```{r, AGE}

filtered_data_age <- survey_data_2007 %>%
  filter(!is.na(age) & as.numeric(age) >= 10)  # This removes NA values and ensures age is 10 or more


filtered_data_age <- filtered_data_age %>%
  mutate(age_numeric = as.numeric(as.character(age)),  # Convert age from string to numeric
         AgeGroup = cut(age_numeric,
                        breaks = c(10, 20, 30, 40, 50, 60, 70, 80, Inf),
                        labels = c("10-20", "20-30", "30-40", "40-50", "50-60", "60-70", "70-80", "80+"),
                        right = FALSE)) %>%
  filter(!is.na(AgeGroup))  # Exclude entries that could not be converted to numeric (including "Don’t know/Refused (VOL.)")


religion_importance_age <- filtered_data_age %>%
  group_by(AgeGroup) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(AgeGroup), !is.na(q21)) %>%  # Ensure q16 and q21 are not NA
  group_by(AgeGroup, q21) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(AgeGroup) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(AgeGroup, q21)


religion_importance_age_selected <- select(religion_importance_age, AgeGroup, q21, Percentage)


religion_importance_age_wide <- pivot_wider(
  religion_importance_age_selected,
  names_from = q21,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(religion_importance_gender_wide)[1] <- "Age"

# Create the table with kable and add styling with kableExtra
table <- kable(religion_importance_age_wide, "html") %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "How important is religion in your life" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box(height  = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>
<br>

```{r , EDUCATION}
religion_importance_edu <- survey_data_2007 %>%
  group_by(educ) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(educ), !is.na(q31)) %>%  # Ensure q16 and q31 are not NA
  group_by(educ, q31) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(educ) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(educ, q31)


religion_importance_edu_selected <- select(religion_importance_edu, educ, q31, Percentage)


religion_importance_edu_wide <- pivot_wider(
  religion_importance_edu_selected,
  names_from = q31,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(religion_importance_edu_wide)[1] <- "Education"

# Create the table with kable and add styling with kableExtra
table <- kable(religion_importance_edu_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "How important is religion in your life" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```


<br>
<br>

### Religious Beliefs 

<br>

#### God

<br>

The survey reveals a widespread belief in God or a universal spirit among American adults, with more than nine-in-ten (92%) affirming this belief. This includes the vast majority of individuals from every major religious tradition, with virtually all Mormon respondents and at least 95% of Catholics, Orthodox Christians, Jehovah’s Witnesses, and members of all three Protestant traditions expressing belief. Even among those not affiliated with a specific religious group, seven-in-ten acknowledge their belief in God or a universal spirit. Notably, a substantial portion of self-described atheists (21%) and more than half of self-described agnostics (55%) also profess belief in God or a universal spirit.



```{r , GOD BELIEF VISUALIZATION}
God_belief <- survey_data_2007 %>%
  filter(q30 == 'Yes') %>% 
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q30)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q31) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q31)



p <- ggplot(God_belief, aes(x = q16, y = q31, fill = Percentage)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), axis.text.y = element_text(size = 12) , title = element_text(size = 15)) +
  labs(title = "believe in God or a universal spirit",
       x = "Religion",
       y = "",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

# Show the interactive plot in your default browser

interactive_plot

```

<br>

There is notable variability in the certainty and nature of individuals' beliefs in God. While at least nine-in-ten Mormons, Jehovah’s Witnesses and Protestant express absolute certainty in the existence of God, smaller majorities of other religious groups also share this conviction. Specifically, Muslims (82%), Catholics (72%), Orthodox Christians (71%), and Hindus (57%) report being completely certain of the existence of God or a universal spirit. In contrast, fewer than half of Jews (41%) and Buddhists (39%) express absolute certainty in the existence of God or a universal spirit.
Notably, approximately one-third of the unaffiliated (36%) assert absolute certainty in the existence of God or a universal spirit, with 8% of atheists claiming absolute certainty in this belief.

<br>

#### Conception of God

<br>



- **God as a Person:** The majority of respondents across different religious affiliations perceive God as a person. This belief is particularly strong among Jehovah’s Witnesses (86.06%), Mormons (92.39%), and Protestants (73.98%).

- **God as an Impersonal Force:** A significant portion of respondents, though smaller compared to those who view God as a person, conceive of God as an impersonal force. This perspective is notably prevalent among Buddhists (61.84%), Hindus (59.75%), and Unitarians (61.11%).

- **Other/Both/Neither:** Some respondents express conceptions of God that do not fit neatly into the categories of "person" or "impersonal force." This group includes individuals who may perceive God in multifaceted ways or hold beliefs outside the typical paradigms of personal or impersonal deities.



<br>

```{r , Conception of God Table}
God_conception <- survey_data_2007 %>%
  filter(q30 == 'Yes') %>% 
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q32)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q32) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q32)


God_conception_selected <- select(God_conception, q16, q32, Percentage)


God_conception_wide <- pivot_wider(
  God_conception_selected,
  names_from = q32,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(God_conception_wide)[1] <- "God Conception"

# Create the table with kable and add styling with kableExtra
table <- kable(God_conception_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Conception of God among who believed in God" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table


```

<br>

**Conclusion:**

The data underscores the diversity of beliefs regarding the nature of God among individuals who identify with various religious traditions. While many perceive God as a personal entity, others conceptualize God as an impersonal force or hold alternative views. Understanding these diverse conceptions enriches our insight into the complex and multifaceted nature of religious beliefs across different faith communities.

<br>


#### Belief in God and Demographic Groups

<br>

Women demonstrate a significantly higher inclination than men to express absolute certainty in their belief in a personal God (81% vs. 72%).

<br>

```{r , SEX GOD BELIEF TABLE}
God_belief_gender <- survey_data_2007 %>%
  filter(q30 == 'Yes') %>%
  group_by(sex) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(sex), !is.na(q31)) %>%  # Ensure q16 and q31 are not NA
  group_by(sex, q31) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(sex) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(sex, q31)


God_belief_gender_selected <- select(God_belief_gender, sex, q31, Percentage)


God_belief_gender_wide <- pivot_wider(
  God_belief_gender_selected,
  names_from = q31,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(God_belief_gender_wide)[1] <- "Sex"

# Create the table with kable and add styling with kableExtra
table <- kable(God_belief_gender_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Belief in God" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

Furthermore, older Americans are notably more likely than younger Americans to profess certain belief in a personal God. Among individuals aged 60 and above, almost eight-in-ten (81%) express this conviction, in contrast with (70%) of those under the age of 30. 

<br>

```{r ,  Age GOD BELIEF TABLE}
God_belief_age <- filtered_data_age %>%
  filter(q30 == 'Yes') %>%
  group_by(sex) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(AgeGroup), !is.na(q31)) %>%  # Ensure q16 and q31 are not NA
  group_by(AgeGroup, q31) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(AgeGroup) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(AgeGroup, q31)


God_belief_age_selected <- select(God_belief_age, AgeGroup, q31, Percentage)


God_belief_age_wide <- pivot_wider(
  God_belief_age_selected,
  names_from = q31,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(God_belief_age_wide)[1] <- "AgeGroup"

# Create the table with kable and add styling with kableExtra
table <- kable(God_belief_age_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Belief in God" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table

```

<br>

In general, Americans with a college education tend to be slightly less inclined to believe with certainty in a personal God compared to those without a degree.

<br>

```{r , EDUCATION GOD BELIEF TABLE}
God_belief_edu <- survey_data_2007 %>%
  group_by(educ) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(educ), !is.na(q21)) %>%  # Ensure q16 and q21 are not NA
  group_by(educ, q21) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(educ) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(educ, q21)


God_belief_edu_selected <- select(God_belief_edu, educ, q21, Percentage)


God_belief_edu_wide <- pivot_wider(
  God_belief_edu_selected,
  names_from = q21,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(God_belief_edu_wide)[1] <- "Education"

# Create the table with kable and add styling with kableExtra
table <- kable(God_belief_edu_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "How important is religion in your life" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>


#### Afterlife

<br>

The data presents varying levels of certainty among individuals from different religious backgrounds regarding the existence of life after death:

- **Absolutely Certain:** A substantial proportion of respondents across several religious affiliations express absolute certainty about life after death. This belief is particularly strong among Mormons (90.86%), Jehovah’s Witnesses (88.89%), and Muslims (86.36%).

- **Fairly Certain:** Many respondents indicate a high degree of confidence, albeit not absolute certainty, in the existence of life after death. This sentiment is prevalent among Christians (Protestants: 76.48%, Christians: 73.73%, Catholics: 61.05%) and members of other religious groups.

- **Uncertainty:** Some respondents express varying degrees of uncertainty regarding life after death. This uncertainty is evident across different religious affiliations, with notable proportions of individuals falling into categories such as "Don’t know/refused" or "Not at all certain."


<br>

```{r, AFTERLIFE BELIEF TABLE }
Afterlife_belief <- survey_data_2007 %>%
  filter(q33 == 'Yes') %>% 
  group_by(q16) %>% 
  filter(n() > 50) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q34)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q34) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q34)


Afterlife_belief_selected <- select(Afterlife_belief, q16, q34, Percentage)


Afterlife_belief_wide <- pivot_wider(
  Afterlife_belief_selected,
  names_from = q34,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Afterlife_belief_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Afterlife_belief_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Life After Death" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 


table
```

<br>

**Conclusion:**

The data highlights the diversity of beliefs concerning life after death among individuals from various religious traditions. While some express unwavering certainty, others hold more nuanced or uncertain perspectives. Understanding these diverse beliefs provides valuable insight into the complex and multifaceted nature of religious beliefs surrounding the concept of life after death.

<br>


#### Belief in Heaven and Hell

**Belief in Heaven Across Different Religious Affiliations:**

The data reflects the varying degrees of belief in heaven among individuals from diverse religious backgrounds:

- **High Belief:** A significant proportion of respondents across several religious groups express a strong belief in heaven. This belief is particularly prominent among Mormons (94.84%), Muslims (83.62%), and Protestants (81.96%).

- **Moderate Belief:** Some respondents exhibit a moderate level of belief in heaven. This category includes individuals from Orthodox Christian traditions (71.90%) and various Christian denominations.

- **Low Belief:** Certain religious affiliations demonstrate lower levels of belief in heaven compared to others. For instance, Buddhists (29.68%) and individuals identifying with "Nothing in particular" (45.40%) exhibit lower rates of belief in heaven.

- **Uncertainty:** A minority of respondents either express uncertainty about their belief in heaven or refrain from providing a clear response ("Don’t know/refused" category). This uncertainty is relatively low across most religious affiliations but is more pronounced among some groups like Jews (13.20%) and Atheists (3.50%).


<br>

```{r, HEAVEN BELIEF TABLE}
Heaven_belief <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q35)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q35) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q35)


Heaven_belief_selected <- select(Heaven_belief, q16, q35, Percentage)


Heaven_belief_wide <- pivot_wider(
  Heaven_belief_selected,
  names_from = q35,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Heaven_belief_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_Heaven <- kable(Heaven_belief_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Belief in Heaven" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_Heaven
```

<br>


<br>

```{r, HELL BELEIEF TABLE}
Hell_belief <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q36)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q36) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q36)


Hell_belief_selected <- select(Hell_belief, q16, q36, Percentage)


Hell_belief_wide <- pivot_wider(
  Hell_belief_selected,
  names_from = q36,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Hell_belief_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_Hell <- kable(Hell_belief_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Belief in Hell" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_Hell
```

<br>

**Belief in Hell Across Different Religious Affiliations:**

The dataset reveals a spectrum of beliefs regarding the concept of hell among individuals from various religious backgrounds:

- **Strong Belief:** A substantial proportion of respondents, particularly from Christian denominations like Jehovah’s Witnesses (8.92%) and Mormons (56.63%), express a strong belief in hell. This belief is also prevalent among Muslims (78.45%) and certain Protestant groups (70.35%).

- **Moderate Belief:** Some respondents demonstrate a moderate level of belief in hell, including individuals from Orthodox Christian traditions (53.44%) and Roman Catholics (59.76%).

- **Low Belief:** Certain religious affiliations exhibit lower levels of belief in hell compared to others. For instance, Buddhists (20.44%) and individuals identifying with "Nothing in particular" (32.69%) show lower rates of belief in hell.

- **Uncertainty:** A minority of respondents express uncertainty about their belief in hell or decline to provide a clear response ("Don’t know/refused" category). This uncertainty is relatively low across most religious affiliations but is more pronounced among some groups like Jews (9.24%) and Atheists (2.91%).


<br>
```{r, HEAVEN HELL VISUALIZAION}
Combined_Heaven_Hell_wide = bind_cols (Heaven_belief_wide$Religion , Heaven_belief_wide$Yes , Hell_belief_wide$Yes)
colnames(Combined_Heaven_Hell_wide)[1] <- "Religion"
colnames(Combined_Heaven_Hell_wide)[2] <- "Heaven"
colnames(Combined_Heaven_Hell_wide)[3] <- "Hell"


# Reshape the data to a long format
long_data <- pivot_longer(
  Combined_Heaven_Hell_wide,
  cols = c("Heaven", "Hell"),
  names_to = "Belief",
  values_to = "Percentage"
)

# Create the bar plot
p <- ggplot(long_data, aes(x = Religion, y = Percentage, fill = Belief)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7)) +
  labs(title = "Percentage of People Believing in Heaven and Hell by Religion",
       x = "Religion",
       y = "Percentage",
       fill = "Belief") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position = "bottom")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 700)

# Show the interactive plot in your default browser

interactive_plot
```

<br>


#### Miracles and the Supernatural

<br>

**Belief in the Occurrence of Miracles Today:**

The survey data provides insights into the beliefs regarding the occurrence of miracles in contemporary times compared to ancient eras among individuals from various religious backgrounds:

- **Strong Belief:** A significant proportion of respondents from the Mormon Church (LDS) (79.17%), Protestant denominations (53.26%), and certain Christian denominations (52.05% to 46.80%) express strong agreement that miracles still occur today, akin to ancient times. This belief is notably high among Mormons, indicating a firm conviction in the continued manifestation of miracles.

- **Moderate Belief:** Some respondents, particularly from Orthodox Christian traditions (41.87%), Islam (39.66%), and Hinduism (24.12%), express a moderate level of agreement with the notion that miracles still happen today. While not as pronounced as in the aforementioned groups, this belief remains notable within these religious affiliations.

- **Uncertainty:** A portion of respondents either express uncertainty about the occurrence of miracles in contemporary times or decline to provide a definitive stance ("Don’t know/refused" category). This uncertainty varies across religious affiliations but is particularly notable among Atheists (61.75%) and individuals identifying with "Nothing in particular" (17.80%).

- **Disagreement:** Certain respondents, including Atheists, Agnostics, and individuals from Jewish, Unitarian Universalist, and certain Christian denominations, express either complete disagreement or a majority disagreement with the idea that miracles still occur today as they did in ancient times.


<br>

```{r, MIRACLE BELIEF Table}
Miracle_belief <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q39a)) %>%  # Ensure q16 and q39b are not NA
  group_by(q16, q39a) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q39a)


Miracle_belief_selected <- select(Miracle_belief, q16, q39a, Percentage)


Miracle_belief_wide <- pivot_wider(
  Miracle_belief_selected,
  names_from = q39a,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Miracle_belief_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_Miracle <- kable(Miracle_belief_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Question: Miracles still occur today as in ancient times" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_Miracle
```

<br>

Similarly, about two-thirds of U.S. adults (68%) believe in the activity of angels and demons in the world. This belief is especially common among members of Christian traditions, including approximately nine-in-ten members of evangelical Protestant churches, Jehovah’s Witnesses, and Mormons.

<br>

```{r, ANGEL AND DEMON BELIEF}
DEMON_belief <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q39b)) %>%  # Ensure q16 and q21 are not NA
  group_by(q16, q39b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q39b)


DEMON_belief_selected <- select(DEMON_belief, q16, q39b, Percentage)


DEMON_belief_wide <- pivot_wider(
  DEMON_belief_selected,
  names_from = q39b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(DEMON_belief_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_Demon <- kable(DEMON_belief_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Question: Angels and demons are active in the world" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_Demon
```

<br>

In contrast, belief in the activity of angels and demons is less common among Buddhists and Hindus, as well as among Jews. While relatively few atheists and agnostics hold this belief.

<br>




### Religious Practices

<br>

#### Worship Attendance

<br>

The data illustrates diverse patterns of attendance across different religious groups. For instance, some groups show higher rates of frequent attendance, such as Jehovah’s Witnesses and Mormons, with a significant proportion attending religious services several times a day. Within the Christian category, there's notable variation in attendance habits. For example, while a considerable portion of Roman Catholics attend services a few times a week or more, Protestant attendees tend to spread more evenly across different levels of attendance frequency.

<br>

```{r, WORSHIP FREQUENCY Table}
Worship_frequency <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q41)) %>%  # Ensure q16 and q41 are not NA
  group_by(q16, q41) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q41)


Worship_frequency_selected <- select(Worship_frequency, q16, q41, Percentage)


Worship_frequency_wide <- pivot_wider(
  Worship_frequency_selected,
  names_from = q41,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Worship_frequency_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Worship_frequency_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Attendance at Religious Services" = 7, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

Atheists and agnostics exhibit lower rates of religious service attendance compared to religious groups. The majority of respondents in these categories report never attending religious services, with atheists (79.2%) and agnostics (44.4%) being the highest in this regard.Those who identify as having "nothing in particular" also show varied attendance patterns, with a significant proportion reporting infrequent or no attendance. Specifically, 24.3% report never attending religious services..Minority religious groups such as Buddhists, Hindus, Muslims, and Jews display diverse attendance patterns, with some members attending services frequently while others rarely do. For example, among Muslims, 68.1% report attending services several times a day, while among Jews, 27.7% attend services a few times a week or more.


<br>


#### Religious Upbringing of Children

<br>

Overall, nearly two-thirds of adults (63%) who have children under age 18 living at home say they pray or read Scripture with their children. Mormons (91%) are especially likely to do this. Roughly
eight-in-ten members of protestan (81%) and historically black (77%) churches also pray or read
Scripture with their children.
Jews (41%), Buddhists (37%) and the unaffiliated (31%) are much less likely to pray or read Scripture with their children compared with members of many other religious traditions. But there are major differences within the unaffiliated group; a majority of the religious unaffiliated (52%)
pray or read Scripture with their children, compared with only 16% of the secular unaffiliated,
19% of agnostics and 8% of atheists.
Similar patterns are seen in parents’ decisions about sending their children to Sunday school or other religious education programs. Six-in-ten Americans with children under age 18 living at
home arrange for them to attend such programs. Mormons (90%) stand out for their propensityto enroll their children in religious education, followed by members of evangelical (79%) and
historically black (77%) churches. More than a third of the unaffiliated (35%) send their children to religious education programs, including a quarter of atheists (24%) and about half of the religious
unaffiliated (49%).
Among parents with children under age 18 living in their homes, 15% home-school their children or send them to a religious school instead of a public school. Jews (27%) and Orthodox Christians
(30%) are most likely to do this.

<br>

```{r, PRAY AND READ SCRIPTURE}
Upbringing_children <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q55a)) %>%  # Ensure q16 and q41 are not NA
  group_by(q16, q55a) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q55a)


Upbringing_children_selected <- select(Upbringing_children, q16, q55a, Percentage)


Upbringing_children_wide <- pivot_wider(
  Upbringing_children_selected,
  names_from = q55a,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Upbringing_children_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_1 <- kable(Upbringing_children_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Send any of your children to Sunday school" = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_1
```

<br>

```{r, RELIGIOUS SCHOOL}
Upbringing_children_2 <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q55b)) %>%  # Ensure q16 and q41 are not NA
  group_by(q16, q55b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q55b)


Upbringing_children_2_selected <- select(Upbringing_children_2, q16, q55b, Percentage)


Upbringing_children_2_wide <- pivot_wider(
  Upbringing_children_2_selected,
  names_from = q55b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Upbringing_children_2_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_2 <- kable(Upbringing_children_2_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Pray or read the Scripture with your child" = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_2
```

<br>


```{r, RELIGIOUS SCHOOL INSTEAD OF PUBLIC SCHOOL}
Upbringing_children_3 <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q55c)) %>%  # Ensure q16 and q41 are not NA
  group_by(q16, q55c) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q55c)


Upbringing_children_3_selected <- select(Upbringing_children_3, q16, q55c, Percentage)


Upbringing_children_3_wide <- pivot_wider(
  Upbringing_children_3_selected,
  names_from = q55c,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Upbringing_children_3_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table_3 <- kable(Upbringing_children_3_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Send your child/childern to religious school instead of a public school" = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table_3
```


<br>

```{r , Religious Upbringing of Children VISUALIZATION}
Combined_Upbringing_children_wide = bind_cols (Upbringing_children_wide$Religion , Upbringing_children_wide$Yes , Upbringing_children_2_wide$Yes , Upbringing_children_3_wide$Yes)
colnames(Combined_Upbringing_children_wide)[1] <- "Religion"
colnames(Combined_Upbringing_children_wide)[2] <- "Pray and read scripture"
colnames(Combined_Upbringing_children_wide)[3] <- "attend religious school on sunday"
colnames(Combined_Upbringing_children_wide)[4] <- "attend religious school instead of public school"


# Reshape the data to a long format
long_data <- pivot_longer(
  Combined_Upbringing_children_wide,
  cols = c("Pray and read scripture", "attend religious school on sunday","attend religious school instead of public school"),
  names_to = "Belief",
  values_to = "Percentage"
)

# Create the bar plot
p <- ggplot(long_data, aes(x = Religion, y = Percentage, fill = Belief)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7)) +
  labs(title = "Percentage of People saying yes to the quesions",
       x = "Religion",
       y = "Percentage",
       fill = "Belief") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position = "bottom")


# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 900)

# Show the interactive plot in your default browser

interactive_plot
```

<br>



Similar patterns are seen in parents’ decisions about sending their children to Sunday school or other religious education programs. Six-in-ten Americans with children under age 18 living at
home arrange for them to attend such programs. Mormons (90%) stand out for their propensity to enroll their children in religious education. More than a third of the unaffiliated (35%) send their children to religious education programs, including a quarter of atheists (24%).
Among parents with children under age 18 living in their homes, 15% home-school their children or send them to a religious school instead of a public school. Jews (27%) and Orthodox Christians
(30%) are most likely to do this.

<br>


### Spiritual Experiences

<br>

#### Spritual Peace and Wonder

<br>

A majority of Americans (52%) report experiencing a sense of spiritual peace and well-being at least once a week. High rates of weekly spiritual peace are observed among Jehovah’s Witnesses and Mormons (77% and 71%, respectively),  Muslims (64%). Conversely, Jews (38%) and the unaffiliated (35%) are among the groups least likely to experience spiritual peace on a weekly basis.

In contrast, a smaller proportion of Americans (39%) report feeling a deep sense of wonder about the universe on a weekly basis. Notably, over half of Buddhists (57%) and Muslims (53%) report experiencing this deep sense of wonder weekly, along with nearly half of Jehovah’s Witnesses (49%).

<br>

```{r, PEACE TABLE}
Peace_Wonder <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q43a)) %>%  # Ensure q16 and q43a are not NA
  group_by(q16, q43a) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q43a)


Peace_Wonder_selected <- select(Peace_Wonder, q16, q43a, Percentage)


Peace_Wonder_wide <- pivot_wider(
  Peace_Wonder_selected,
  names_from = q43a,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Peace_Wonder_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Peace_Wonder_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "feel a deep sense of spiritual peace and well-being" = 5, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

```{r, WONDER TABLE}
Peace_Wonder <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q43a)) %>%  # Ensure q16 and q43b are not NA
  group_by(q16, q43b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q43b)


Peace_Wonder_selected <- select(Peace_Wonder, q16, q43b, Percentage)


Peace_Wonder_wide <- pivot_wider(
  Peace_Wonder_selected,
  names_from = q43b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Peace_Wonder_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Peace_Wonder_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "feel a deep sense of wonder about the universe" = 5, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

While Mormons and protestant diverge from the general public on various religious beliefs and practices, they align closely with the broader population on this particular question. Approximately 41% of protestant, 43% of Mormons report feeling a deep sense of wonder about the universe on a weekly basis. This places them in close proximity to Jews (40%) and the unaffiliated (39%).

Interestingly, within the unaffiliated category, agnostics stand out as the subgroup most likely to frequently experience a sense of wonder, with 48% reporting weekly occurrences. This contrasts with the figures for atheists (37%), the religious unaffiliated (40%).

<br>


#### Is There More Than One Path to Salvation?

<br>

**Quesion**: My religion is the one true faith leading to eternal
life, OR Many religions can lead to eternal life.

```{r, FAITH FLEXIBILITY}
Faith_flexibility <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q40a)) %>%  # Ensure q16 and q43b are not NA
  group_by(q16, q40a) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q40a)


Faith_flexibility_selected <- select(Faith_flexibility, q16, q40a, Percentage)


Faith_flexibility_wide <- pivot_wider(
  Faith_flexibility_selected,
  names_from = q40a,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Faith_flexibility_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Faith_flexibility_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "is There More Than One Path to Salvation" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```


<br>


```{r, More Than One Path VISUALIZAION}
# Assuming Combined_Heaven_Hell_wide has two columns: Religion, and Percentage with values for Heaven and Hell
# Inverting sign for "Hell" percentages
# Sample data frame
religions <- Faith_flexibility_wide$Religion
many_religions <- Faith_flexibility_wide$`Many religions can lead to eternal life - Second statement`
one_true_faith <- Faith_flexibility_wide$`My religion is the one, true faith leading to eternal life -`

df <- data.frame(
  Religion = factor(religions, levels = religions),
  `who_say_many_religions_can_lead_to_eternal_life` = many_religions,
  `who_say_my_religion_is_the_one_true_faith_leading_to_eternal_life` = -one_true_faith
)


# Sort the religions based on 'Many religions can lead to eternal life'
df_sorted <- df %>%
  arrange(desc(`who_say_many_religions_can_lead_to_eternal_life`))

# Update the factor levels of Religion to the new order
df_sorted$Religion <- factor(df_sorted$Religion, levels = df_sorted$Religion)

long_df <- pivot_longer(
  df_sorted,
  cols = c(`who_say_many_religions_can_lead_to_eternal_life`, `who_say_my_religion_is_the_one_true_faith_leading_to_eternal_life`),
  names_to = "Belief",
  values_to = "Percentage"
)

long_df <- long_df[order(long_df$Percentage, decreasing = TRUE),]

# Create the plot
p <- ggplot(long_df, aes(x = Religion, y = Percentage, fill = Belief)) +
  geom_bar(stat = "identity", position = "identity") +
  coord_flip() +
  scale_fill_manual(values = c("#FFA07A", "blue")) +
  labs(title = "Religious Exclusivity",
       x = "",
       y = "Percentage")+
  theme_minimal() +
  theme(legend.position = "right",
        
        axis.ticks.y = element_blank(),
        panel.grid = element_blank())


# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 500)

# Show the interactive plot in your default browser

interactive_plot


```



<br>
<br>

The majority of Americans with a religious affiliation believe that many religions can lead to eternal life, with seven-in-ten holding this view. This perspective is widespread across various religious traditions, including more than eight-in-ten Jews, Buddhists, Hindus, and Protestant, as well as nearly eight-in-ten Catholics. However 56% of Muslims, share this belief. Notably, among Mormons and Jehovah’s Witnesses, a majority assert that their religion is the sole path to eternal life.



#### How Strictly to Interpret the Faith?

<br>

**Quesion**: There is only ONE true way to interpret the teachings of
my religion, OR There is MORE than one true way to
interpret the teachings of my religion.

<br>

More than two-thirds of Americans with a religious affiliation (68%) believe in the possibility of multiple interpretations of their faith's teachings. A majority of members of evangelical churches (64%) share this view, along with upwards of six-in-ten individuals from most other religious traditions. Notably, a significant proportion of Jews (89%) and Buddhists (90%) express the belief in multiple valid interpretations of their religion's teachings. However, Mormons and Jehovah’s Witnesses differ on this point, with majorities from both groups (54% among Mormons, 77% among Jehovah’s Witnesses) asserting that there is only one true interpretation of their religion's teachings.

<br>


```{r, STRICT INTERPRET TABLE}
Faith_flexibility <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q40b)) %>%  # Ensure q16 and q40b are not NA
  group_by(q16, q40b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q40b)


Faith_flexibility_selected <- select(Faith_flexibility, q16, q40b, Percentage)


Faith_flexibility_wide <- pivot_wider(
  Faith_flexibility_selected,
  names_from = q40b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Faith_flexibility_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Faith_flexibility_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Strictness of Interpretation" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```


<br>

```{r, STRICT INTERPRET VISUALIZAION}

religions <- Faith_flexibility_wide$Religion
many_religions <- Faith_flexibility_wide$`There is MORE than one true way to interpret the teachings o`
one_true_faith <- Faith_flexibility_wide$`There is only ONE true way to interpret the teachings of my`

df <- data.frame(
  Religion = factor(religions, levels = religions),
  `There_is_MORE_than_one_true_way_to_interpret_the_teachings` = many_religions,
  `There_is_only_one_true_way_to_interpret_the_teachings` = -one_true_faith
)


# Sort the religions based on 'Many religions can lead to eternal life'
df_sorted <- df %>%
  arrange(desc(`There_is_MORE_than_one_true_way_to_interpret_the_teachings`))

# Update the factor levels of Religion to the new order
df_sorted$Religion <- factor(df_sorted$Religion, levels = df_sorted$Religion)

long_df <- pivot_longer(
  df_sorted,
  cols = c(`There_is_MORE_than_one_true_way_to_interpret_the_teachings`, `There_is_only_one_true_way_to_interpret_the_teachings`),
  names_to = "Belief",
  values_to = "Percentage"
)

long_df <- long_df[order(long_df$Percentage, decreasing = TRUE),]

# Create the plot
p <- ggplot(long_df, aes(x = Religion, y = Percentage, fill = Belief)) +
  geom_bar(stat = "identity", position = "identity") +
  coord_flip() +
  scale_fill_manual(values = c("#FFA07A", "blue")) +
  labs(title = "Religious Interpretablility",
       x = "",
       y = "Percentage")+
  theme_minimal() +
  theme(legend.position = "right",
        
        axis.ticks.y = element_blank(),
        panel.grid = element_blank())


# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 500)

# Show the interactive plot in your default browser

interactive_plot
```

<br>





### Beliefs About Morality
<br>

**Quesion**: There are clear and absolute standards for what is right and wrong.

<br>

```{r, Morality Table}
Right_Wrong <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q10b)) %>%  # Ensure q16 and q10b are not NA
  group_by(q16, q10b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q10b)


Right_Wrong_selected <- select(Right_Wrong, q16, q10b, Percentage)


Right_Wrong_wide <- pivot_wider(
  Right_Wrong_selected,
  names_from = q10b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Right_Wrong_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Right_Wrong_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Absolute Standards of Right and Wrong" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

While most Americans believe in absolute standards of right and wrong, there are some differences among groups. For example, Buddhists, atheists, and agnostics are somewhat less likely to believe in absolute standards compared to other religious groups or the religiously unaffiliated as a whole. This suggests that while there's a general trend toward believing in universal moral principles, individual beliefs can vary based on religious background or lack thereof.

<br>

### Conclusion

<br>


The analysis of religious beliefs and practices across a diverse array of faiths and those without religious affiliation reveals significant insights into how religion—or the absence of it—shapes individuals' worldviews, ethical standards, and daily practices.

**Religious Affiliations**: For those with religious affiliations, religion typically serves as a foundational element in their lives, deeply influencing their morals, behaviors, and outlooks. These individuals often view their religious tenets as not just beliefs but as integral truths that guide their understanding of the world, their behavior, and their expectations of the afterlife. They tend to participate more actively in community and religious rituals, which reinforces their faith and fosters a sense of belonging and identity. The belief in divine beings, miracles, and an active spiritual realm is prevalent, reflecting a worldview where the divine intimately interacts with the world.

**Non-religious Individuals (Atheists, Agnostics, Unaffiliated)**: In contrast, those without religious affiliations often embrace a worldview grounded in secularism or humanism. This group tends to place less importance on structured beliefs and shows a higher propensity for skepticism towards supernatural claims and absolute truths. However, this does not imply a lack of ethical or moral consideration; many non-religious individuals still exhibit strong moral convictions and a sense of wonder about the universe, which they might attribute to philosophical or humanistic insights rather than spiritual or religious beliefs. Importantly, their engagement with spiritual practices, while less frequent, often occurs in a context that values cultural heritage or personal exploration over religious duty.

**Shared Human Experience**: Despite these differences, both groups share fundamental human experiences and emotions, such as the quest for meaning, the experience of awe, and the need for ethical guidelines. Both religious and non-religious individuals seek peace, purpose, and explanations for the complex world around them, albeit through different lenses.

**Conclusion**: This analysis suggests that while religious beliefs significantly shape one's worldview and daily practices, underlying human experiences such as ethical dilemmas, spiritual peace, and existential wonder are universal. These findings indicate that the essence of human experience crosses the boundaries of religious and secular divides, pointing to a shared search for understanding and meaning that transcends specific belief systems. Thus, the dialogue between individuals of varying religious and non-religious backgrounds is not only possible but essential for a comprehensive understanding of the human condition.


<br>


## Chapter 2: Social and Political Views

<br>

While religion might not always be seen as the main influence on social and political views for most Americans, the Landscape Survey reveals strong connections between religious affiliation, beliefs, and societal attitudes. This suggests that religion might have a significant, albeit indirect, role in shaping people's perspectives more than they realize.

This chapter delves into the social and political stances of different religious groups. When possible, it breaks down these traditions further based on key measures of religious commitment, like how often someone attends worship services or the importance they place on religion in their lives. The analysis reveals that religious divisions often align with political fault lines, but also cut across them.

Despite the diversity of religious beliefs and practices in the U.S., there's widespread agreement across most faiths about the positive impact of religion in society. Many Americans reject the idea that religion causes more problems than it solves. Moreover, most religious individuals don't see a conflict between their devoutness and living in a modern society.

<br>

### Religion and Society
<br>

#### Religion and Societal Problems

<br>

**Quesion**: Religion causes more problems in society than it solves.

<br>


- **Strong Agreement:** Atheists and agnostics tend to strongly agree with the notion that religion causes more harm than good. This perspective likely stems from a belief in secularism and skepticism toward religious institutions' influence on societal affairs.

- **Varied Perspectives:** Other religious groups exhibit more diverse views. For example, Mormons and Protestants largely disagree with the statement, indicating a belief in the positive contributions of religion to society. Conversely, Buddhists, Hindus, and Jews show mixed sentiments, with a significant portion expressing agreement or uncertainty.

- **Neutral or Uncertain Stance:** Some respondents, particularly those who volunteered as "Don't know/Refused," refrain from taking a definitive position on the matter. This could indicate a lack of clarity or hesitation in expressing a viewpoint.



```{r, ANTI RELIGIOUS}
Anti_religious_belief <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q39c)) %>%  # Ensure q16 and q39c are not NA
  group_by(q16, q39c) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q39c)


Anti_religious_belief_selected <- select(Anti_religious_belief, q16, q39c, Percentage)


Anti_religious_belief_wide <- pivot_wider(
  Anti_religious_belief_selected,
  names_from = q39c,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Anti_religious_belief_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Anti_religious_belief_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Question: Religion causes more problems in society than it solves" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

**Conclusion:**

The data reflects the complexity of attitudes toward religion's societal impact, highlighting contrasting perspectives among different religious affiliations. While some groups strongly believe in religion's detrimental effects, others emphasize its positive influence. Understanding these varied viewpoints is essential for fostering dialogue and addressing societal challenges related to religion's role in contemporary life.

<br>

#### Exploring Conflicts in Modern Living

<br>
```{r,  RELIGIOUS CONFLICT}
Peaceful_living <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q46)) %>%  # Ensure q16 and q41 are not NA
  group_by(q16, q46) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q46)


Peaceful_living_selected <- select(Peaceful_living, q16, q46, Percentage)


Peaceful_living_wide <- pivot_wider(
  Peaceful_living_selected,
  names_from = q46,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Peaceful_living_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Peaceful_living_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "there is natural conflict between being a devout religious person and living in a modern society," = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```
<br>


Among various religious groups, there's a range of perspectives:
The majority of Buddhists (69.3%), Hindus (62.6%), and Jews (64.2%) don't perceive a conflict. Conversely, Jehovah’s Witnesses (59.6%), Protestants (41.8%), and Christians in general (37.5%) are more likely to see a conflict.
Muslims (35.3%) and Orthodox Christians (32.8%) also lean towards perceiving a conflict. Overall, while there's diversity in opinions, around a third to a half of respondents across different religious affiliations see a natural conflict between devout religious practice and living in a modern society.
<br>

```{r, NON RELIGIOUS CONFLICT}
Peaceful_living_non <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q47)) %>%  # Ensure q16 and q41 are not NA
  group_by(q16, q47) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q47)


Peaceful_living_non_selected <- select(Peaceful_living_non, q16, q47, Percentage)


Peaceful_living_non_wide <- pivot_wider(
  Peaceful_living_non_selected,
  names_from = q47,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Peaceful_living_non_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Peaceful_living_non_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "there is a natural conflict between being a non-religious person and living in a society where most people are religious," = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>


Agnostics (38.4%) and atheists (43.1%) are more likely to perceive a conflict. Those with no religious affiliation, such as "nothing in particular," also show a similar trend, with 29.6% perceiving a conflict. However, a majority of respondents in these categories (57.3% for agnostics, 52.2% for atheists, and 64.3% for those with no particular affiliation) don't perceive such a conflict.
Notably, a significant proportion of respondents who refused to answer or didn't know expressed uncertainty (27.6%) or didn't perceive a conflict (51.2%). Overall, while a notable portion of non-religious individuals perceive a conflict between their beliefs and a predominantly religious society, the majority across these categories do not share this perception.

<br>



### Satisfaction 

<br>

First I want to go through all quesions about the different aspects of satisfaction.

<br>
**Quesion**:Are you very satisfied, somewhat satisfied, somewhat DISsatisfied or very DISsatisfied? (Your standard of living -- what you can buy or do)
<br>

```{r, Personal Satisfaction Table}
Personal_satisfaction <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q3a)) %>%  # Ensure q16 and q3a are not NA
  group_by(q16, q3a) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q3a)


Personal_satisfaction_selected <- select(Personal_satisfaction, q16, q3a, Percentage)


Personal_satisfaction_wide <- pivot_wider(
  Personal_satisfaction_selected,
  names_from = q3a,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Personal_satisfaction_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Personal_satisfaction_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Personal Life Satisfaction" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

table
```

<br>
**Quesion**: Are you very satisfied, somewhat satisfied, somewhat DISsatisfied or very DISsatisfied? (With your family life)
<br>

```{r, Family Life Satisfaction}

family_life_satisfaction <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q3b)) %>%  # Ensure q16 and q3a are not NA
  group_by(q16, q3b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q3b)


family_life_satisfaction_selected <- select(family_life_satisfaction, q16, q3b, Percentage)


family_life_satisfaction_wide <- pivot_wider(
  family_life_satisfaction_selected,
  names_from = q3b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(family_life_satisfaction_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(family_life_satisfaction_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Family Life Satisfaction" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

table
```

<br>
**Quesion**:Are you very satisfied, somewhat satisfied, somewhat DISsatisfied or very DISsatisfied? (With the way the political system is working in this country)
<br>

```{r, Standard of Living Satisfaction}
Standard_of_living_satisfaction <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q3c)) %>%  # Ensure q16 and q3a are not NA
  group_by(q16, q3c) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q3c)


Standard_of_living_satisfaction_selected <- select(Standard_of_living_satisfaction, q16, q3c, Percentage)


Standard_of_living_satisfaction_wide <- pivot_wider(
  Standard_of_living_satisfaction_selected,
  names_from = q3c,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Standard_of_living_satisfaction_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Standard_of_living_satisfaction_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Standard of Life Satisfaction" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

table
```

<br>
**Quesion**: Are you very satisfied, somewhat satisfied, somewhat DISsatisfied or very DISsatisfied? (With your personal safety from things like crime and terrorism)
<br>

```{r, Personal safety Satisfaction}
Personal_Safety <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q3d)) %>%  # Ensure q16 and q3a are not NA
  group_by(q16, q3d) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q3d)


Personal_Safety_selected <- select(Personal_Safety, q16, q3d, Percentage)


Personal_Safety_wide <- pivot_wider(
  Personal_Safety_selected,
  names_from = q3d,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Personal_Safety_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Personal_Safety_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Personal Safety Satisfaction" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

table
```

<br>

Now based on this quesions and answer I'm gonna create the measure of Satisfaction within all individuals.
Certainly! Here's the explanation you can use:

<br>


**Total Satisfaction Metric Explanation:**

<br>

To quantify overall satisfaction from responses to four questions (q3a, q3b, q3c, q3d) in the survey, a Total Satisfaction Metric is computed. This metric converts qualitative responses into numerical scores using the following mapping:

- **'Very satisfied'**: Scored as 1
- **'Somewhat satisfied'**: Scored as 0.75
- **'Somewhat dissatisfied'**: Scored as 0.25
- **'Very dissatisfied'**: Scored as 0
- **'Don’t know/Refused'**: Scored as 0.5 ( My idea was that if somebody can't classify his answers to binary class of dissatisfied or satisfied, he/she probably has higher satisfaction than someone with dissatisfied answers)

These scores represent the level of satisfaction associated with each response, with higher scores indicating higher levels of satisfaction.

The Total Satisfaction Metric is calculated by summing the scores from the four questions for each respondent. The resulting score provides an aggregate measure of satisfaction, allowing for easy comparison across respondents.

Mathematically, the Total Satisfaction Metric (\(TSM\)) can be represented as:

\[ TSM = \sum_{i=1}^{4} Score_i \]

Where:
- \(TSM\) is the Total Satisfaction Metric,
- \(Score_i\) is the score assigned to the response for the \(i^{th}\) question.

<br>

```{r, Total Satisfaction Score}


map_satisfaction_scores <- function(satisfaction, detail) {
  case_when(
    satisfaction == 'Satisfied' & detail == 'Very' ~ 1,
    satisfaction == 'Satisfied' & detail == 'Somewhat' ~ 0.75,
    satisfaction == 'Dissatisfied' & detail == 'Very' ~ 0,
    satisfaction == 'Dissatisfied' & detail == 'Somewhat' ~ 0.25,
    # Assuming 'Don’t know/Refused' is for cases where detail might not be answered
    satisfaction == 'Satisfied' & detail == 'Don’t know/Refused' ~ 0.75, 
    satisfaction == 'Dissatisfied' & detail == 'Don’t know/Refused' ~ 0.25,
    TRUE ~ 0.5  # Default case for any other combinations, including unhandled 'Don’t know/Refused'
  )
}

# Apply this mapping function to your dataset for Q1/Q1a and Q2/Q2a
survey_data_2007 <- survey_data_2007 %>%
  mutate(q1_Score = map_satisfaction_scores(as.character(q1), as.character(q1a)),
         q2_Score = map_satisfaction_scores(as.character(q2), as.character(q2a)))


# Map scores for Q3 questions directly
satisfaction_mapping <- c('Very satisfied' = 1, 'Somewhat satisfied' = 0.75, 'Somewhat dissatisfied' = 0.25, 'Very dissatisfied' = 0, 'Don’t know/Refused' = 0.5)

survey_data_2007 <- survey_data_2007 %>%
  mutate(across(c(q3a, q3b, q3c, q3d), ~ satisfaction_mapping[.], .names = "{.col}_Score"))

# Calculate total satisfaction score
survey_data_2007$Total_Satisfaction <- rowSums(survey_data_2007[, grepl("_Score$", names(survey_data_2007))], na.rm = TRUE)

# Viewing the results
head(survey_data_2007[, c("q1_Score", "q2_Score", "q3a_Score", "q3b_Score", "q3c_Score", "q3d_Score", "Total_Satisfaction")])

```



<br>
<br>

```{r, Average Satisfaction score for each religion}

average_satisfaction_by_religion <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>%
  summarise(Average_Satisfaction = mean(Total_Satisfaction, na.rm = TRUE))


# Plot the data using ggplot
p <- ggplot(average_satisfaction_by_religion, aes(x = q16, y = Average_Satisfaction, fill = q16)) +
  geom_bar(stat = "identity", width = 0.7) +  # Use identity to indicate that y values are already calculated
  
  labs(title = "Average Satisfaction by Religion",
       x = "Religion",
       y = "Average Satisfaction") +
  
  theme_minimal() +  # Use a minimal theme
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Adjust text alignment if needed
        legend.position = "none")  # Remove legend since color coding is redundant

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 800)

# Show the interactive plot in your default browser

interactive_plot
```

<br>
<br>
**Average Satisfaction by Religious Affiliation:**

The average satisfaction levels for various religious affiliations provide valuable insights into the overall contentment reported by individuals within each group. While there are fluctuations across different affiliations, the average satisfaction score serves as a broad indicator of the perceived fulfillment among members of each religious community.

Across the spectrum, the average satisfaction tends to hover around a certain range, typically between 2.4 and 2.7. However, some religious affiliations stand out with notably higher or lower average satisfaction scores.

For instance, Hindus display a relatively high average satisfaction score of 2.70, indicating a generally contented outlook within this religious community. On the other hand, Jehovah’s Witnesses report a lower average satisfaction score of 2.08, suggesting a lower overall satisfaction level among its members.

Among the affiliations with average satisfaction scores that deviate from the norm, Mormons, with an average satisfaction score of 2.80, demonstrate a notably higher level of contentment compared to the general trend. Conversely, individuals identifying as Don’t know/Refused exhibit a slightly lower average satisfaction score of 2.35, indicating a relatively lower reported satisfaction level within this group.


```{r, Density Function for Satisfaction Score}
# Create a density plot to visualize the distribution of Total_Satisfaction
p <- ggplot(survey_data_2007, aes(x = Total_Satisfaction)) +
  geom_density(fill = "lightblue", adjust = 4) +
  labs(title = "Density Plot of Total Satisfaction Scores",
       x = "Total Satisfaction Score",
       y = "Density") +
  theme_minimal()

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 500)

# Show the interactive plot in your default browser

interactive_plot
```

<br>


### Happiness

<br>

Based on the data provided, it seems that individuals who identify with a religious affiliation generally report higher levels of happiness compared to those who do not identify with any religion. Across various religious groups, there appears to be a trend of higher reported happiness levels, with a significant portion of respondents indicating that they are either "Pretty happy" or "Very happy."

Interestingly, even within religious groups, there is variation in reported happiness levels. For example, Mormons and Unitarian Universalists tend to report particularly high levels of happiness, while Jehovah's Witnesses and Christians who volunteered their religion report lower levels of happiness compared to some other religious groups.

Overall, while there are differences among various religious affiliations, the data suggests a positive association between religious identification and reported happiness levels.

<br>

```{r, Happiness Table}
Happiness <- survey_data_2014 %>%
  group_by(qe1) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(qe1), !is.na(qa1)) %>%  # Ensure qe1 and qa1 are not NA
  group_by(qe1, qa1) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(qe1) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(qe1, qa1)
Happiness_selected <- select(Happiness, qe1, qa1, Percentage)


Happiness_wide <- pivot_wider(
  Happiness_selected,
  names_from = qa1,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Happiness_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Happiness_wide, "html", align = c('l', rep('c', 10))) %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "How do you describe your Happiness state" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

```{r, Happiness Visualizaion}




p <- ggplot(Happiness, aes(x = qe1, y = qa1, fill = Percentage)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), axis.text.y = element_text(size = 12), title = element_text(size = 20)) +
  labs(title = "Happiness among different Religion",
       x = "Religion",
       y = "Happiness",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

interactive_plot <- interactive_plot %>% layout(autosize = F)
# Show the interactive plot in your default browser

interactive_plot

```

<br>

### Average Salary


<br>
Analyzing the average income across different religious affiliations provides valuable insights into the economic status and financial well-being of individuals within each group. These figures offer a broad overview of the income levels reported by members of various religious communities, highlighting potential disparities and trends.
<br>

```{r, Average Income level Visulaizaion}
# Map income categories to approximate average values
income_mapping <- c(
    'Less than $10,000' = 5000,
    '10 to under $20,000' = 15000,
    '20 to under $30,000' = 25000,
    '30 to under $40,000' = 35000,
    '40 to under $50,000' = 45000,
    '50 to under $75,000' = 62500,
    '75 to under $100,000' = 87500,
    '100 to under $150,000' = 125000,
    '$150,000 or more' = 200000,
    "Don't know/Refused (VOL.)" = NA  # Handle unknown/refused with NA or an appropriate value
)

# Assuming survey_data_2007 is your dataframe
survey_data_2007 <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n()>100) %>% 
  mutate(Average_Income = income_mapping[income])

average_income_by_religion <- survey_data_2007 %>%
  group_by(q16) %>%
  summarise(Average_Income = mean(Average_Income, na.rm = TRUE))  # Excluding NA values

sorted_average_income_by_religion <- average_income_by_religion %>%
  arrange(Average_Income)

# Ensure 'q16' is ordered according to the sorted data
sorted_average_income_by_religion$q16 <- factor(sorted_average_income_by_religion$q16, 
                                                levels = sorted_average_income_by_religion$q16)

# Plot the data using ggplot
p <- ggplot(sorted_average_income_by_religion, aes(x = q16, y = Average_Income, fill = q16)) +
  geom_bar(stat = "identity", width = 0.7) +  # Use identity to indicate that y values are already calculated
  
  labs(title = "Average Income by Religion",
       x = "Religion",
       y = "Average Satisfaction") +
  
  theme_minimal() +  # Use a minimal theme
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Adjust text alignment if needed
        legend.position = "none")  # Remove legend since color coding is redundant

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 800)

# Show the interactive plot in your default browser

interactive_plot


```

<br>
The average income among different religious affiliations varies significantly, reflecting diverse economic circumstances and opportunities experienced by individuals within each group.

For instance, Hindus and Jews report relatively higher average incomes compared to other religious affiliations, with Hindus averaging $109,829.55 and Jews averaging $108,230.77. These figures suggest a relatively affluent economic status among members of these religious communities.

On the other hand, Jehovah’s Witnesses report a notably lower average income of $48,531.07, indicating a comparatively lower economic standing within this religious group.

Among the affiliations with average income figures deviating from the norm, atheists and agnostics display relatively higher average incomes, with atheists averaging $85,928.25 and agnostics averaging $79,537.67. Conversely, individuals identifying as Don’t know/Refused report a slightly lower average income of $72,870.37, indicating a relatively lower reported income level within this group.

<br>

```{r, Density Function for Income}
# Create a density plot to visualize the distribution of Total_Satisfaction
p <- ggplot(survey_data_2007, aes(x = Average_Income)) +
  geom_density(fill = "lightblue", adjust = 4) +
  labs(title = "Density Plot of Income",
       x = "Total Satisfaction Score",
       y = "Density") +
  theme_minimal()

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 500)

# Show the interactive plot in your default browser

interactive_plot
```

<br>

### Religion and “Culture War” Issues

<br>

#### Abortion

<br>



Abortion is a deeply complex and contentious issue that has sparked significant debate and controversy across various societies and cultures. Defined as the termination of a pregnancy by removing an embryo or fetus from the uterus before it can survive outside the womb, abortion raises profound ethical, moral, religious, and legal questions.

In the United States, discussions surrounding abortion have been central to public discourse and policymaking for decades. The fundamental question of whether abortion should be legally permissible and under what circumstances has divided individuals, communities, and religious groups, reflecting differing perspectives on the sanctity of life, bodily autonomy, women's rights, and the role of government in regulating reproductive healthcare.

Against this backdrop, understanding the views of individuals within different religious affiliations regarding abortion provides valuable insights into the diverse range of beliefs, values, and moral considerations shaping public opinion on this complex issue.

<br>

```{r, Abortion Table}
Abortion <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q7)) %>%  # Ensure q16 and q7 are not NA
  group_by(q16, q7) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q7)


Abortion_selected <- select(Abortion, q16, q7, Percentage)


Abortion_wide <- pivot_wider(
  Abortion_selected,
  names_from = q7,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Abortion_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Abortion_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Abortion Should Be…" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

Notably, there is considerable diversity in attitudes towards abortion among different religious affiliations:

- **Christian Denominations:** Within Christian denominations, opinions vary widely, with some groups, such as Jehovah's Witnesses and Mormons, expressing stronger opposition to abortion, while others, like Unitarians and Protestants, exhibit more nuanced views, including significant support for abortion rights.

- **Non-Christian Religions:** Hindus, Muslims, and Buddhists also display a range of perspectives, with differing proportions advocating for different levels of legality regarding abortion.

- **Non-Affiliated Individuals:** In contrast, individuals identifying as having "Nothing in particular" or providing a "Don't Know/Refused" response tend to demonstrate more nuanced views on abortion, with a greater willingness to support legal access to abortion in certain circumstances.

<br>
<br>

#### Homosexuality

<br>
The topic of homosexuality elicits diverse perspectives, often influenced by cultural, religious, and personal beliefs. Understanding attitudes towards homosexuality within different religious communities provides valuable insights into the intersections of faith and social acceptance.
<br>


```{r, Homosexuality Table}
Homosexuality <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q5b)) %>%  # Ensure q16 and q7 are not NA
  group_by(q16, q5b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q5b)


Homosexuality_selected <- select(Homosexuality, q16, q5b, Percentage)


Homosexuality_wide <- pivot_wider(
  Homosexuality_selected,
  names_from = q5b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Homosexuality_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Homosexuality_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Homosexuality Should Be…" = 3, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>
<br>



- **Acceptance vs. Disapproval:** Individuals from religious backgrounds, such as Jehovah's Witnesses, Mormons, and Muslims, tend to express more disapproval towards homosexuality. This aligns with teachings in these faiths that may view homosexuality as inconsistent with religious doctrine or moral principles.

- **Moderate Views:** Certain religious groups, such as Protestants and Orthodox Christians, exhibit more moderate perspectives on homosexuality, with a sizable portion expressing neither strong acceptance nor strong disapproval. This suggests a degree of diversity within these religious communities regarding attitudes towards homosexuality.

- **Acceptance:** Conversely, individuals identifying as agnostic, atheist, or having "Nothing in particular" as their religious affiliation tend to demonstrate higher levels of acceptance towards homosexuality. This reflects a trend observed among those who may not adhere to specific religious teachings or who prioritize secular values over religious doctrines.


The data underscores the complexity of attitudes towards homosexuality within different religious contexts. While some religious groups exhibit more conservative views, others demonstrate greater acceptance or neutrality. These findings highlight the multifaceted relationship between religion and social attitudes, emphasizing the need for dialogue and understanding across diverse religious perspectives in discussions surrounding LGBTQ+ rights and social inclusion.

<br>
<br>


#### Evolution

<br>
**Question**: Evolution is the best explanation for the origins of human life on earth
<br>
Debates over the origins of human life have long been a focal point in discussions on science, religion, and philosophy. One of the key areas of contention is the acceptance of evolution as the primary explanation for the origins of human life. Understanding the perspectives of different religious groups on this issue provides valuable insights into the intersection of faith and scientific understanding.

<br>


```{r, Evolution Table}
Evolution <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q10c)) %>%  # Ensure q16 and q7 are not NA
  group_by(q16, q10c) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q10c)


Evolution_selected <- select(Evolution, q16, q10c, Percentage)


Evolution_wide <- pivot_wider(
  Evolution_selected,
  names_from = q10c,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Evolution_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Evolution_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Evolution as the Best Explanation for the Origins of Human Life" = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>

- **High Acceptance:** Individuals identifying as atheists, agnostics, and Unitarians demonstrate the highest levels of agreement with evolution as the best explanation for human life's origins. This aligns with the scientific consensus and reflects a tendency among those with more secular or progressive religious views to embrace evolutionary theory.

- **Moderate Acceptance:** Certain religious groups, such as Buddhists and Jews, exhibit moderate levels of agreement with evolution. While not as high as atheists or agnostics, these groups still show a substantial proportion endorsing evolutionary theory, suggesting a degree of compatibility between their religious beliefs and scientific understanding.

- **Low Acceptance:** Conversely, individuals from more conservative religious backgrounds, such as Jehovah's Witnesses, Mormons, and Muslims, tend to express lower levels of agreement with evolution. This likely reflects theological teachings or interpretations that may conflict with evolutionary principles.

**Conclusion:**
The data highlights the diversity of perspectives among different religious groups regarding the acceptance of evolution as the best explanation for human life's origins. While some religious traditions demonstrate high levels of acceptance, others exhibit more skepticism or outright rejection of evolutionary theory. These findings underscore the complex relationship between religion and science, emphasizing the importance of fostering dialogue and understanding across diverse religious perspectives in discussions concerning the origins of human life.


<br>
<br>

#### Churches and Politics

<br>

**Question**: In your opinion, should churches and other houses of worship keep out of political matters - or should they express their views on
day-to-day social and political questions?

<br>

The role of churches in expressing views on political matters is a topic of considerable debate and contention. While some argue that churches should actively engage in political discourse as part of their societal role, others advocate for a separation of church and state, suggesting that religious institutions should refrain from direct involvement in political affairs.

<br>

```{r, Church and Politics Table}
Church_politics <- survey_data_2007 %>%
  group_by(q16) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(q16), !is.na(q9)) %>%  # Ensure q16 and q7 are not NA
  group_by(q16, q9) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(q16) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(q16, q9)


Church_politics_selected <- select(Church_politics, q16, q9, Percentage)


Church_politics_wide <- pivot_wider(
  Church_politics_selected,
  names_from = q9,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Church_politics_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Church_politics_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "Should Churches Express Views on Politics?" = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>
<br>

- **Support for Expression:** Individuals identifying as Protestants, Mormons, and Christians generally favor churches expressing views on political matters. This inclination may stem from a belief in the moral authority of religious institutions and their role in shaping societal values and policies.

- **Preference for Neutrality:** Conversely, atheists, agnostics, and Unitarians tend to advocate for churches keeping out of political issues. This reflects a desire to maintain a clear separation between religious and political domains, preserving individual autonomy and diversity of belief.

- **Moderate Views:** Some religious groups, such as Buddhists, Jews, and Hindus, demonstrate more mixed perspectives. While they may acknowledge the potential for churches to engage in political discourse, they also recognize the importance of maintaining impartiality and avoiding undue influence on political processes.

<br>



### Conclusion

The survey data from various religious and non-religious groups reveal profound insights into how religion influences social perceptions, behaviors, and personal satisfaction within society. It suggests that religion can be both a source of conflict and a provider of community, shaping attitudes toward modern societal norms and personal well-being in diverse ways.

**Influence on Societal Views**: Individuals from religious backgrounds often view their faith as a stabilizing force, contributing positively to their lives and communities. This is evident in the higher satisfaction rates regarding family and personal life among those with strong religious affiliations like Hindus and Mormons. In contrast, non-religious individuals, including atheists and agnostics, tend to view religion more critically, often perceiving it as a source of social tension or conflict. This group is more likely to believe that religion complicates social issues rather than resolves them, highlighting a stark difference in how the role of religion in society is perceived.

**Impact on Ethical and Social Issues**: The data shows that religious beliefs significantly influence attitudes towards contentious social and ethical issues such as abortion and homosexuality. More conservative views are prevalent among traditionally religious groups like Jehovah's Witnesses and Mormons, while more liberal views tend to be held by those who are non-religious or part of more progressive religious groups like Unitarians. This division underscores how religious doctrines can shape fundamental social attitudes and behaviors.

**Adaptation to Modernity**: There is a perceived conflict between devout religious practice and living in a modern society, particularly among groups with strict doctrinal adherence. However, many believers find ways to reconcile their faith with modern values, indicating that religion evolves with societal changes. Non-religious individuals also face their own challenges, particularly in societies where religious norms predominate, suggesting a universal theme of navigating personal beliefs in diverse social landscapes.

**General Well-being and Religion**: The relationship between religion and personal satisfaction is complex. While religious affiliation often correlates with higher levels of family and personal life satisfaction—possibly due to stronger community bonds and support systems—the less religious report varying degrees of satisfaction, influenced by their personal and social environments.

<br>

## Chapter 3 : The Changing Religious Trends

<br>

### Changes in Religious Affiliations

<br>

In this section, we will focus on analyzing the change in religious affiliations between 2007 and 2014. By examining how the proportions of each religious group shifted over time, we aim to uncover trends and patterns in religious identification within the surveyed population. This analysis will provide insights into the evolving religious landscape and shed light on the dynamics driving changes in religious adherence during the specified period.

<br

1. **Overall Trends**:
   - The category "Nothing in particular" experienced the most significant increase in both absolute count and percentage change, indicating a rise in individuals who don't identify with any specific religious affiliation.
   - Protestantism witnessed a substantial decline both in count and percentage, indicating a decrease in adherence to Protestant denominations.
   - Other religious groups like Buddhism, Hinduism, and Orthodox Christianity saw declines in counts and percentages, albeit to a lesser extent compared to Protestantism.
   - Atheism and Agnosticism saw notable increases in both count and percentage, suggesting a rise in non-theistic beliefs or uncertainties about the existence of God.
   - Muslim and Jewish communities experienced moderate increases in number and percentage, indicating potential growth or stability in their populations.

<br>


```{r, Religion affiliation 2014}

# Assuming 'qe1' is the column for religion
religion_counts_2014 <- survey_data_2014 %>%
  count(qe1) %>%
  filter(n > 100)

# Rename the columns for clarity
colnames(religion_counts_2014) <- c("Religion", "Respondents")


# Calculate the total number of respondents
total_respondents <- sum(religion_counts_2014$Respondents)

# Calculate percentages
religion_counts_2014 <- religion_counts_2014 %>%
  mutate(Percentage = (Respondents / total_respondents) * 100)


# Rename the columns for clarity
colnames(religion_counts_2007) <- c("Religion", "Respondents_2007","Percentage_2007")
colnames(religion_counts_2014) <- c("Religion", "Respondents_2014","Percentage_2014")

# Assuming religion_counts_2007 and religion_counts_2014 are your data frames
# First, ensure that the 'Religion' column is treated as a character for accurate comparisons
religion_counts_2007$Religion <- as.character(religion_counts_2007$Religion)
religion_counts_2014$Religion <- as.character(religion_counts_2014$Religion)

# Identify religions present in both 2007 and 2014
common_religions <- intersect(religion_counts_2007$Religion, religion_counts_2014$Religion)

# Filter both data frames to include only common religions
religion_counts_2007 <- religion_counts_2007 %>%
  filter(Religion %in% common_religions)

religion_counts_2014 <- religion_counts_2014 %>%
  filter(Religion %in% common_religions)

# Merge the data frames
religion_changes <- merge(religion_counts_2007, religion_counts_2014, by = "Religion")

# Calculate changes
religion_changes <- religion_changes %>%
  mutate(Count_Change = Respondents_2014 - Respondents_2007,
         Percentage_Change = Percentage_2014 - Percentage_2007)

```


```{r, Religion affiliation changes}
p <- ggplot(religion_changes, aes(x = reorder(Religion, -Percentage_Change), y = Percentage_Change, fill = Religion)) +
  geom_col() +
  coord_flip() +
  labs(title = "Change in Religious Affiliation from 2007 to 2014",
       x = "Religion",
       y = "Change in Count") +
  theme_minimal() +
  theme(legend.position = "none")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 500)

# Show the interactive plot in your default browser

interactive_plot
```

<br>

   
2. **Specific Changes**:
   - Roman Catholicism and Protestantism, the two largest religious groups in the dataset, experienced declines in both count and percentage, with Protestantism witnessing a relatively larger decrease.
   - While some religious groups saw declines in counts, their percentage changes varied due to shifts in the overall respondent population.
   - Jehovah's Witness and Mormon denominations experienced slight increases in counts and percentages, indicating stability or minor growth within these communities.

These changes suggest a dynamic landscape of religious affiliation over the examined period, with shifts towards non-affiliation or alternative religious beliefs alongside declines in traditional denominations like Protestantism and Catholicism.

<br>

### Changing Perceptions of Religion's Importance

<br>

This section provides a comparative analysis of the importance of religion in individuals' lives across various religious groups between the years 2007 and 2014. Through a side-by-side visualization, the shift in attitudes towards religion is depicted, showcasing the percentage of respondents within each religious category who rated religion as "Not at all important," "Not too important," "Somewhat important," and "Very important." The chart illuminates trends suggesting a declining emphasis on religion over time, with some groups demonstrating a more pronounced shift towards secularism, while others maintain a steadfast commitment to religious values. This examination offers valuable insights into the evolving landscape of religious beliefs and practices in contemporary society.

<br>

```{r, Religion Importance 2014}

religion_importance_2014 <- survey_data_2014 %>%
  group_by(qe1) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(qe1), !is.na(qf2)) %>%  # Ensure qe1 and qf2 are not NA
  group_by(qe1, qf2) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(qe1) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(qe1, qf2)

religion_importance_2014_selected <- select(religion_importance_2014, qe1, qf2, Percentage)


religion_importance_2014_wide <- pivot_wider(
  religion_importance_2014_selected,
  names_from = qf2,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(religion_importance_2014_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(religion_importance_2014_wide, "html", align = c('l', rep('c', 10))) %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "How important is religion in your life (2014) " = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table

```



```{r, Changes in importance of religion}
# Assuming the data frames are named religion_importance_2007 and religion_importance_2014


# Filter both data frames to include only common religions
religion_counts_2007 <- religion_counts_2007 %>%
  filter(Religion %in% common_religions)

religion_counts_2014 <- religion_counts_2014 %>%
  filter(Religion %in% common_religions)

# Convert data from wide to long format for easier plotting
religion_importance_2007_long <- pivot_longer(religion_importance_wide, cols = -Religion, names_to = "Importance", values_to = "Percentage_2007")
religion_importance_2014_long <- pivot_longer(religion_importance_2014_wide, cols = -Religion, names_to = "Importance", values_to = "Percentage_2014")

# Filter both data frames to include only common religions
religion_importance_2007_long <- religion_importance_2007_long %>%
  filter(Religion %in% common_religions)

religion_importance_2014_long <- religion_importance_2014_long %>%
  filter(Religion %in% common_religions)

```



```{r, Changes in response of imporance of religion viuslization}
# Merge the two datasets

religion_importance_combined <- full_join(religion_importance_2007_long, religion_importance_2014_long, by = c("Religion", "Importance"))

# Check and clean any NA values that might result from the join if there are religions not present in both datasets
religion_importance_combined <- drop_na(religion_importance_combined)

# Changes in religion importance 
religion_importance_combined <- religion_importance_combined %>% 
  mutate(Percentage_change = Percentage_2014 - Percentage_2007)


# Heatmap for both years
p <- ggplot(religion_importance_combined, aes(x = Religion, y = Importance, fill = Percentage_change)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), axis.text.y = element_text(size = 12), title = element_text(size = 20)) +
  labs(title = "Changes in responses on the Importance of Religion by Religious Group",
       x = "Religion",
       y = "Importance",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

# Show the interactive plot in your default browser

interactive_plot




```

<br>


**Explanation**:
This visualization illustrates the evolving perception of the importance of religion in the lives of various religious groups between 2007 and 2014. The chart depicts the percentage of respondents within each religious group who reported different levels of importance

Key observations from the visualization might include:
1. Overall, there appears to be a trend towards decreased importance of religion across most religious groups from 2007 to 2014.
2. Some groups, such as atheists and agnostics, show a notable increase in the percentage of respondents who view religion as "Not at all important," suggesting a shift towards secularism.
3. Conversely, certain groups like Jehovah’s Witnesses and Mormons seem to maintain a consistently high percentage of respondents who perceive religion as "Very important" throughout both years.
4. The chart also highlights variations in the importance of religion among different religious communities, reflecting the diversity of attitudes and beliefs within and across religious traditions.

<br>


### Shifting Views on Religion and “Culture War” Issues

<br>

#### Shifting Views on Abortion Abortion

<br>

This section presents a comparative examination of attitudes towards abortion across different religious groups between the years 2007 and 2014. The data illustrate respondents' opinions on whether abortion should be illegal or legal in varying circumstances, including "Illegal in all cases," "Illegal in most cases," "Legal in all cases," and "Legal in most cases." By juxtaposing the percentages of respondents within each religious category, the chart highlights evolving perspectives on abortion rights over time.

<br>





```{r}
Abortion_2014 <- survey_data_2014 %>%
  group_by(qe1) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(qe1), !is.na(qb21)) %>%  # Ensure qe1 and qb21 are not NA
  group_by(qe1, qb21) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(qe1) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(qe1, qb21)

Abortion_2014_selected <- select(Abortion_2014, qe1, qb21, Percentage)


Abortion_2014_wide <- pivot_wider(
  Abortion_2014_selected,
  names_from = qb21,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Abortion_2014_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Abortion_2014_wide, "html", align = c('l', rep('c', 10))) %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "Abortion Should Be… " = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

```{r, Trend in Abortion}

# Convert data from wide to long format for easier plotting
Abortion_2007_long <- pivot_longer(Abortion_wide, cols = -Religion, names_to = "Importance", values_to = "Percentage_2007")
Abortion_2014_long <- pivot_longer(Abortion_2014_wide, cols = -Religion, names_to = "Importance", values_to = "Percentage_2014")

# Filter both data frames to include only common religions
Abortion_2007_long <- Abortion_2007_long %>%
  filter(Religion %in% common_religions)

Abortion_2014_long <- Abortion_2014_long %>%
  filter(Religion %in% common_religions)
# Merge the two datasets

Abortion_combined <- full_join(Abortion_2007_long, Abortion_2014_long, by = c("Religion","Importance"))

# Check and clean any NA values that might result from the join if there are religions not present in both datasets
Abortion_combined <- drop_na(Abortion_combined)

# Changes in religion importance 
Abortion_combined <- Abortion_combined %>% 
  mutate(Percentage_change = Percentage_2014 - Percentage_2007)


# Heatmap for both years
p <- ggplot(Abortion_combined, aes(x = Religion, y = Importance, fill = Percentage_change)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), title = element_text(size = 15)) +
  labs(title = "Changes in responses on the Abortion by Religious Group",
       x = "Religion",
       y = "",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

# Show the interactive plot in your default browser

interactive_plot


```

<br>

1. **Consistency in Views**: Some religious groups, such as Mormons (LDS) and Jews, maintained relatively consistent stances on abortion between 2007 and 2014. These groups showed minimal changes in their percentages across the categories of "Illegal in all cases," "Illegal in most cases," "Legal in all cases," and "Legal in most cases." This consistency suggests a stable adherence to their respective religious teachings or moral convictions regarding abortion over the years.

2. **Decrease in Opposition**: In several religious categories, there was a decrease in the percentage of respondents favoring strict restrictions on abortion. For example, among Protestants and Roman Catholics, there was a decline in the proportion of respondents advocating for abortion to be illegal in all or most cases. This shift may indicate a growing acceptance of more liberal abortion policies within these religious communities over time.

3. **Increase in Support for Legalization**: Conversely, some religious groups saw an increase in the percentage of respondents supporting legalized abortion, particularly in certain circumstances. This trend was evident among Atheists, Buddhists, and Muslims, where a higher proportion of respondents expressed support for abortion being legal in all or most cases in 2014 compared to 2007. This suggests a potential loosening of traditional views on abortion within these religious communities.

4. **Varied Responses**: While some religious groups exhibited clear shifts towards either more restrictive or more permissive attitudes on abortion, others showed mixed or inconsistent changes. For instance, Jehovah's Witnesses and Orthodox Christians displayed fluctuating percentages across different categories, indicating a divergence of opinions within these religious communities over the years.

<br>

#### Changing Attitudes Towards Homosexuality

<br>

This analysis examines the evolving perceptions of homosexuality within different religious communities over the span of seven years, from 2007 to 2014. By comparing data from these two time points, we gain insights into the shifting attitudes towards LGBTQ+ rights and acceptance within various religious groups. The findings highlight trends such as decreasing disapproval, increasing acceptance, and the variability of attitudes across different religious affiliations. 

<br>

```{r, Homosexuality 2014 Table}
Homosexuality_2014 <- survey_data_2014 %>%
  group_by(qe1) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(qe1), !is.na(qb22)) %>%  # Ensure qe1 and q2b2 are not NA
  group_by(qe1, qb22) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(qe1) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(qe1, qb22)

Homosexuality_2014_selected <- select(Homosexuality_2014, qe1, qb22, Percentage)


Homosexuality_2014_wide <- pivot_wider(
  Homosexuality_2014_selected,
  names_from = qb22,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Homosexuality_2014_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Homosexuality_2014_wide, "html", align = c('l', rep('c', 10))) %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "Allowing gays and lesbians to marry legally? " = 4, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```

<br>


1. **Consistency in Acceptance**: In both 2007 and 2014, Agnostics, Atheists, and Buddhists consistently showed high levels of acceptance towards homosexuality. These groups maintained relatively stable percentages of respondents who believed that homosexuality is a way of life that should be accepted.

2. **Decrease in Disapproval**: Across various religious categories, there was a notable decrease in the percentage of respondents who believed that homosexuality should be discouraged. For example, among Mormons (LDS) and Muslims, there was a decline in the proportion of individuals advocating for discouraging homosexuality. This suggests a shift towards more accepting attitudes within these religious communities over time.

3. **Increase in Acceptance**: Conversely, some religious groups witnessed an increase in the percentage of respondents supporting the acceptance of homosexuality. Notably, Protestants and Orthodox Christians showed a rise in the proportion of individuals endorsing acceptance of homosexuality as a way of life. This indicates a potential evolution in attitudes towards LGBTQ+ rights within these religious communities over the surveyed period.

4. **Religious Variability**: The data also reveal a diverse range of attitudes towards homosexuality across different religious groups. While some communities, such as Unitarian Universalists, overwhelmingly support the acceptance of homosexuality, others, like Jehovah's Witnesses, maintain more conservative views on the matter.

<br>

#### Shifts in Beliefs on Evolution

<br>

This comparative study examines the changing attitudes towards evolution across different religious affiliations between 2007 and 2014. The data reveals shifts in opinions regarding the origins of human life and the role of evolution, from the influence of a supreme being to natural processes such as natural selection.

<br>

```{r , Evolution 2014 Table}

Evolution_2014 <- survey_data_2014 %>%
  group_by(qe1) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(qe1), !is.na(qb30b)) %>%  # Ensure qe1 and q2b2 are not NA
  group_by(qe1, qb30b) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(qe1) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(qe1, qb30b)

Evolution_2014_selected <- select(Evolution_2014, qe1, qb30b, Percentage)


Evolution_2014_wide <- pivot_wider(
  Evolution_2014_selected,
  names_from = qb30b,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Evolution_2014_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Evolution_2014_wide, "html", align = c('l', rep('c', 10))) %>%
  kable_styling("striped", full_width = F) %>%
  add_header_above(c(" " = 1, "Allowing gays and lesbians to marry legally? " = 2, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```


<br>


1. **Agnostic and Atheist Perspectives:** Both agnostic and atheist respondents consistently leaned towards acceptance of evolution due to natural processes across both years. While there were slight fluctuations, the majority maintained their stance in favor of natural selection as the explanation for the origins of human life.

2. **Buddhist, Hindu, and Unitarian Universalist Views:** These groups also exhibited strong support for evolution driven by natural processes, with minimal changes observed between 2007 and 2014. Their beliefs remained largely consistent over the seven-year period.

3. **Christian Denominations:** Within Christian denominations, there was a notable divide. While some denominations, such as Unitarian Universalists, showed overwhelming support for evolution driven by natural processes, others, particularly Jehovah's Witnesses and Mormons, maintained beliefs in a supreme being guiding evolution. Protestant and Roman Catholic groups demonstrated mixed views, with a significant portion supporting natural selection but also a sizable minority endorsing a divine-guided evolution.

5. **Overall Trends:** Across most religious groups, there was a slight increase in acceptance of evolution driven by natural processes from 2007 to 2014. This indicates a gradual shift towards secular interpretations of evolutionary theory within various religious communities, although some groups still maintain strong beliefs in divine involvement in the process.



<br>

### Changes in Frequency of Experiencing Spiritual Peace and Well-being 

<br>

This section examines the shifts in the frequency of experiencing spiritual peace and well-being among various religious groups between 2007 and 2014. The data reveal changes in the proportions of respondents within each group who reported experiencing spiritual peace and well-being at different frequencies, ranging from at least once a week to never. 

<br>


```{r , Peace and Wonder Table 2014}
Peace_Wonder_2014 <- survey_data_2014 %>%
  group_by(qe1) %>% 
  filter(n() > 100) %>% # Keep only religions with more than 100 respondents
  ungroup() %>% 
  filter(!is.na(qe1), !is.na(qi4a)) %>%  # Ensure qe1 and q14a are not NA
  group_by(qe1, qi4a) %>%
  summarise(Count = n(), .groups = 'drop') %>%  # Count occurrences and drop grouping
  ungroup() %>% 
  group_by(qe1) %>%
  mutate(Total = sum(Count), 
         Percentage = (Count / Total) * 100) %>%
  ungroup() %>% 
  arrange(qe1, qi4a)


Peace_Wonder_2014_selected <- select(Peace_Wonder_2014, qe1, qi4a, Percentage)


Peace_Wonder_2014_wide <- pivot_wider(
  Peace_Wonder_2014_selected,
  names_from = qi4a,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)

colnames(Peace_Wonder_2014_wide)[1] <- "Religion"

# Create the table with kable and add styling with kableExtra
table <- kable(Peace_Wonder_2014_wide, "html") %>%
  kable_styling("striped", full_width = T) %>%
  add_header_above(c(" " = 1, "feel a deep sense of spiritual peace and well-being" = 5, " " = 1)) %>%
  row_spec(0, bold = T, color = "white", background = "#636363") %>%
  scroll_box( height = "100%") %>% 
  column_spec(1, bold = T) 

# If you want to see the table in RStudio's Viewer
table
```



```{r, Peace and Wonder changes Visualizaiton}

# Convert data from wide to long format for easier plotting
Peace_Wonder_2007_long <- pivot_longer(Peace_Wonder_wide, cols = -Religion, names_to = "Importance", values_to = "Percentage_2007")
Peace_Wonder_2014_long <- pivot_longer(Peace_Wonder_2014_wide, cols = -Religion, names_to = "Importance", values_to = "Percentage_2014")

# Filter both data frames to include only common religions
Peace_Wonder_2007_long <- Peace_Wonder_2007_long %>%
  filter(Religion %in% common_religions)

Peace_Wonder_2014_long <- Peace_Wonder_2014_long %>%
  filter(Religion %in% common_religions)
# Merge the two datasets

Peace_Wonder_combined <- full_join(Peace_Wonder_2007_long, Peace_Wonder_2014_long, by = c("Religion","Importance"))

# Check and clean any NA values that might result from the join if there are religions not present in both datasets
Peace_Wonder_combined <- drop_na(Peace_Wonder_combined)

# Changes in religion importance 
Peace_Wonder_combined <- Peace_Wonder_combined %>% 
  mutate(Percentage_change = Percentage_2014 - Percentage_2007)


# Heatmap for both years
p <- ggplot(Peace_Wonder_combined, aes(x = Religion, y = Importance, fill = Percentage_change)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), title = element_text(size = 15)) +
  labs(title = "Changes in responses on the sense spritual by Religious Group",
       x = "Religion",
       y = "",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

# Show the interactive plot in your default browser

interactive_plot
```

<br>


1. **Overall Trends:** Across most religious groups, there is a consistent pattern of a decrease in the proportion of respondents who report experiencing spiritual peace and well-being at least once a week, coupled with an increase in those reporting never experiencing it. This suggests a potential decline in regular spiritual practices or feelings of spiritual fulfillment over the surveyed period.

2. **Variability Among Groups:** While the overall trend shows a decrease in weekly spiritual experiences, the extent of this change varies among different religious groups. For instance, some groups, such as Jehovah’s Witnesses and Mormons, maintained high levels of weekly spiritual experiences, while others, like Buddhists and Hindus, showed more variability.

3. **Shifts in "Never" Category:** A significant increase in the proportion of respondents reporting never experiencing spiritual peace and well-being is notable across several religious groups. This shift raises questions about potential changes in religious participation, beliefs, or societal factors impacting spiritual practices.

4. **Stability in Some Groups:** Interestingly, certain groups, such as Muslims and Orthodox Christians, show relatively stable patterns in the frequency of spiritual experiences. This stability may reflect the resilience of traditional religious practices and beliefs within these communities over time.

<br>




### Conclusion

<br>

Throughout Chapter 3, we have systematically examined the shifting landscapes of religious affiliation, the importance of religion, attitudes towards controversial cultural issues, and experiences of spiritual well-being. Our analyses span from broad demographic shifts to nuanced changes in beliefs and practices over time.

**Changes in Religious Affiliations:**
- The analysis reveals a significant fluidity in religious affiliations between 2007 and 2014. Notably, there was a discernible trend towards non-affiliation, with increases in the "Nothing in particular" category, alongside rises in atheism and agnosticism. Simultaneously, traditional religious affiliations such as Protestantism and Catholicism saw declines, reflecting a broader trend of secularization in American society.

**Changing Perceptions of Religion's Importance:**
- The importance of religion has seen varying levels of decline across different groups, indicating a shift towards secular values over the surveyed period. However, contrasts remain stark among different religious communities, with some maintaining a strong emphasis on religious practices and beliefs.

**Shifting Views on Religion and 'Culture War' Issues:**
- Attitudes towards contentious social issues like abortion and homosexuality have evolved, with a general trend towards more liberal views, especially among younger and less traditionally religious demographics. However, there remains substantial variability, with some groups showing remarkable consistency in their views due to deep-seated religious beliefs.

**Changes in Frequency of Experiencing Spiritual Peace and Well-being:**
- There appears to be a general decline in regular spiritual experiences, with an increase in individuals reporting never experiencing spiritual peace and well-being. This change could reflect shifting engagement with traditional religious practices or broader societal changes affecting personal and communal spiritual lives.




## Chapter 4 : Modelings

<br>


### Modeling Religious Affiliation Dynamics: A Transition Probability Approach

<br>

For Chapter 4 of your project, you are conducting an exploration of religious dynamics, focusing specifically on how individuals transition between religions from childhood to adulthood. Your analysis aims to model the changing composition of religious affiliations in a society over time, using a matrix of transition probabilities. Here’s a structured and clear explanation of your approach and objectives:

#### Purpose of the Analysis

The primary goal of this analysis is to understand the dynamics of religious affiliation in society by studying how individuals may change their religious affiliations from childhood to adulthood. You seek to:

1. **Quantify the Transition Probabilities:** Calculate the probability that a person born or identified with one religion (childhood religion) will transition to another religion (adulthood religion). This involves analyzing survey data to determine the proportion of individuals who switch from each religion to another, compared to the total number of individuals who started in each religion.

2. **Simulate Religious Composition Over Time:** Use the calculated transition probabilities to simulate how the distribution of religious affiliations changes over time within a fixed population. This simulation will help visualize potential trends and shifts in religious composition under the assumption that no other demographic factors (like birth, death, or immigration) affect the population.

3. **Identify Steady States:** Determine if the simulation reaches a steady state where the proportions of each religion in the population remain constant over successive time periods, suggesting a balance in how individuals transition between religions.

#### Methodology


##### Calculation of Transition Probabilities
For each religion X (childhood religion), calculate the probability of transitioning to each religion Y (adulthood religion) as follows:

\[ P(Y|X) = \frac{\text{Number of people who changed their religion from } X \text{ to } Y}{\text{Total number of children with religion } X} \]

This results in a transition matrix where each element (i, j) represents the probability of transitioning from religion i to religion j.

##### Simulation of Religious Composition
- **Initial Setup:** Start with the initial distribution of religious affiliations based on the survey data.
- **Application of Transition Matrix:** At each simulation step, apply the transition matrix to the current distribution of religions to obtain the distribution for the next time period.
- **Repeat Until Steady State:** Continue applying the transition matrix over multiple time periods to observe how the religious composition evolves until it stabilizes or reaches a steady state.



<br>




```{r, warning=FALSE , message=FALSE}


# the columns are named 'qj1' for childhood religion and 'qe1' for current religion
transition_counts <- survey_data_2014 %>%
  filter(!is.na(qj1) & !is.na(qe1)) %>% 
  group_by(qj1) %>% 
  filter(n()>100) %>% 
  ungroup() %>% 
  group_by(qe1) %>% 
  filter(n()>150) %>% 
  ungroup() %>%
  group_by(qj1,qe1) %>%
  filter(n()>10) %>%
  summarise(count = n()) %>%
  ungroup()

# Summarize total counts for each childhood religion
total_per_child_religion <- transition_counts %>%
  group_by(qj1) %>%
  summarise(Total_Count = sum(count))

# Calculate percentages
transition_percentages <- transition_counts %>%
  left_join(total_per_child_religion, by = "qj1") %>%
  mutate(Percentage = (count / Total_Count) * 100) %>%
  select(qj1, qe1, count, Percentage)


# Create nodes and links for the Sankey diagram
node_names <- unique(c(as.character(transition_counts$qj1), as.character(transition_counts$qk1)))
nodes <- data.frame(name = node_names)
links <- transition_counts %>%
  mutate(source = match(qj1, node_names) - 1,  # Indexing starts at 0 for JavaScript
         target = match(qe1, node_names) - 1,
         value = count)


# First we need to create an igraph object from the transition data
graph_data <- transition_percentages %>%
  select(source = qj1, target = qe1, weight = Percentage)



# Create the graph object using igraph
graph <- graph_from_data_frame(transition_percentages, directed = TRUE)

# Create groups based on connected components if there is no explicit community detection
com <- components(graph)
grp <- com$membership

# Add group information to the nodes/vertices
V(graph)$group <- grp



mycolors <- RColorBrewer::brewer.pal(min(max(grp), 8), "Set1")
if (max(grp) > 8) {
  mycolors <- grDevices::colors()[seq(from = 1, to = max(grp))]
}
names(mycolors) <- unique(grp)

# Make the arc diagram with ggraph
p <- ggraph(graph, layout = 'linear') + 
  geom_edge_arc(edge_width = 0.3, edge_colour="black", edge_alpha=0.2, fold=TRUE) +
  geom_node_point(aes(size = degree(graph, v = V(graph)), color = factor(group)), alpha = 0.5) +
  scale_size_continuous(range=c(0.5,8)) +
  scale_color_manual(values=mycolors) +
  geom_node_text(aes(label=name), angle=65, hjust=1, nudge_y = -1.1, size=2.3) +
  labs(title = 'transition of religions')+
  theme_void() +
  theme(
    title = element_text(size = 20),
    legend.position="none",
    plot.margin=unit(c(0,0,0.4,0), "null"),
    panel.spacing=unit(c(0,0,3.4,0), "null")
  ) +
  expand_limits(x = c(-1.2, 1.2), y = c(-5.6, 1.2)) 

# Use ggsave() to save the plot with specified dimensions
ggsave("arc_diagram.png", plot = p, width = 12, height = 8, units = "in", dpi = 300)


```




<br>

![](arc_diagram.png)

<br>
<br>

This arc diagram visually represents the transitions individuals make from their childhood religion to their current religion. Each node (dot) on the horizontal axis represents a different religious affiliation, and the arcs (curved lines) indicate the movement of people between these affiliations over time. The size of a node reflects the number of individuals who either remain in or leave a particular religion.


<br>

```{r}
transition_percentages_2014_selected <- select(transition_percentages, qj1, qe1, Percentage)


transition_percentages_2014_wide <- pivot_wider(
  transition_percentages_2014_selected,
  names_from = qj1,  # This column's unique values will become the names of the new columns
  values_from = Percentage,  # The cell values will come from the 'Percentage' column
  values_fill = list(Percentage = 0)  # Fill missing combinations with 0%
)
transition_percentages_2014_wide

# Heatmap for both years
p <- ggplot(transition_percentages_2014_selected, aes(x = qe1, y = qj1, fill = Percentage)) +
  geom_tile() + # Create the tiles for the heatmap
  scale_fill_gradient(low = "white", high = "steelblue") + # Gradient from white (low) to steel blue (high)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), title = element_text(size = 15)) +
  labs(title = "Transition Probability of changing religion",
       x = "Adulthood Religion",
       y = "Childhood Religion",
       fill = "Percentage")

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 750)

# Show the interactive plot in your default browser

interactive_plot

```



<br>

The heatmap depicts changes in religious affiliation from childhood to adulthood across various groups. 
Observing the concentration of darker shades along the diagonal would suggest that many individuals remain within their childhood religion. However, deviations from the diagonal where darker shades appear indicate notable transitions from one religion to another (notable for Protestant and Nothing in particular). 

<br>


To simulate the evolution of the population's religious affiliations, we start with an initial population vector \( \mathbf{P}(0) \), where each element \( P_i(0) \) represents the number of individuals affiliated with religion \( i \) at the beginning of our simulation (time \( t = 0 \)).

At each subsequent time point \( t \), we update the population vector using the following formula:

\[ \mathbf{P}(t) = \mathbf{P}(t-1) \times \mathbf{T} \]

where:
- \( \mathbf{P}(t) \) is the population vector at time \( t \), with \( P_i(t) \) being the number of individuals affiliated with religion \( i \).
- \( \mathbf{P}(t-1) \) is the population vector from the previous time point \( t-1 \).
- \( \mathbf{T} \) is the transition matrix, with each element \( T_{ij} \) representing the probability of an individual transitioning from religion \( i \) to religion \( j \).

The multiplication of \( \mathbf{P}(t-1) \) by \( \mathbf{T} \) applies the transition probabilities to the population vector, producing a new distribution of religious affiliations at time \( t \). This process models how individuals may change their religious affiliations over time, allowing us to forecast the potential shifts in the religious composition of the population.

By repeating this calculation for each time step, we construct a time series of population vectors \( \{ \mathbf{P}(1), \mathbf{P}(2), \ldots, \mathbf{P}(t) \} \), which depict the dynamics of religious affiliation within the population across the simulated time periods.


<br>

```{r}



# Convert percentage to probability
transition_matrix <- transition_percentages_2014_wide %>%
  select(-qe1) %>% # Remove the first column which contains labels
  mutate_all(~ .x / 100) # Convert percentages to probabilities


# Convert percentages to probabilities (divide by 100)
transition_percentages_2014_selected$Percentage <- transition_percentages_2014_selected$Percentage / 100

# Creating a wide matrix with all religions both in rows and columns
transition_matrix <- transition_percentages_2014_selected %>%
  spread(key = qj1, value = Percentage, fill = 0)  # Use the correct key and value fields

# Ensure all unique religions are included as rows and columns
all_religions <- union(unique(transition_percentages_2014_selected$qe1), unique(transition_percentages_2014_selected$qj1))

# Create an empty full transition matrix with zeros
full_matrix <- matrix(0, nrow = length(all_religions), ncol = length(all_religions),
                      dimnames = list(all_religions, all_religions))

# Fill the full matrix with the available probabilities
for (i in 1:nrow(transition_percentages_2014_selected)) {
  from_religion <- transition_percentages_2014_selected$qe1[i]
  to_religion <- transition_percentages_2014_selected$qj1[i]
  probability <- transition_percentages_2014_selected$Percentage[i]
  full_matrix[from_religion, to_religion] <- probability
}

# Convert to a data frame for visualization/checking
transition_df <- as.data.frame(full_matrix)


simulate_religion_dynamics <- function(pop, P, max_time) {
  pop_matrix <- matrix(0, nrow = max_time, ncol = length(pop))
  pop_matrix[1,] <- pop
  for (t in 2:max_time) {
    pop_matrix[t,] <- pop_matrix[t-1,] %*% P
  }
  return(pop_matrix)
}

# Initial Population based on the data
initial_population <- c(1474 , 1098 , 5000, 15000, 264, 750, 7200, 200, 199, 244, 847, 664, 237, 186)

# Run the simulation
result <- simulate_religion_dynamics(initial_population, t(full_matrix), max_time = 40)

# Assuming 'result' is your matrix from the simulation
result_df <- as.data.frame(result)
time <- 1:nrow(result_df)
result_df <- cbind(time, result_df)

# Melt the data frame for ggplot
result_long <- result_df %>%
  pivot_longer(cols = -time, names_to = "Religion", values_to = "Population")

# # Name the religions appropriately if not automatically named
religions <- names(transition_df)
result_long$Religion <- rep(religions, times = 40)


p <- ggplot(result_long, aes(x = time, y = Population, color = Religion )) +
  geom_line() +
  theme_minimal() +
  labs(title = "Religion Population Dynamics",
       x = "Time",
       y = "Population") +
  
  theme(legend.title = element_blank())


# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 600)

# Show the interactive plot in your default browser

interactive_plot
```


<br>

#### Conclusion

The graph shows us a snapshot of religious shifts over time. We observe that the number of individuals identifying as Protestant and those stating "Nothing in particular" are on the rise, while the Roman Catholic group is seeing a decrease. Other religions appear to be fairly steady in their numbers. These trends are mostly consistent with the actual changes in religious affiliation observed between 2007 and 2014, with the growth of the Protestant group as an exception.

It's important to note that this is a simplified model that doesn't account for factors like immigration, birth, and mortality rates, which all play a significant role in shaping the religious composition of a population. Nonetheless, this model serves as a promising starting point for more detailed future studies that could incorporate these additional elements.







<br>

### Analyzing the Predictors of Religious Change from Childhood to Adulthood Using Random Forest and GLM

<br>

#### Random Forest Classifier

<br>

Understanding how and why individuals change their religious beliefs over time is crucial for both sociological research and practical applications within community planning and policy making. The complexity of religious belief systems and their influence on personal and social life demand a sophisticated analytical approach to capture the nuanced changes individuals may experience.

<br>


```{r}

# Calculate the percentage of missing values for each column
missing_percentage <- sapply(survey_data_2014, function(x) sum(is.na(x)) / length(x)) * 100

# Set threshold for removal
threshold <- 0

# Find columns with missing value percentage greater than the threshold
columns_to_remove <- names(missing_percentage[missing_percentage > threshold])

# Remove the columns from the dataset
data_clean_2014 <- survey_data_2014[, !(names(survey_data_2014) %in% columns_to_remove)]

data_clean_2014 <- data_clean_2014 %>%
  mutate(Religion_Change = if_else(qj1 == qe1, "Same", "Changed")) %>% 
  filter(respondent_birthregion != "Don't know/refused") %>%  # Remove "Don't know/refused"
  mutate(Immigration_Status = if_else(respondent_birthregion == "U.S.", "Non-Immigrant", "Immigrant"))

# # Remove feature
data_clean_2014 <- select(data_clean_2014,-qj1, -qe1)

# # Ensure the target variable is a factor
data_clean_2014$Religion_Change <- factor(data_clean_2014$Religion_Change)

data_clean_2014 <- data_clean_2014 %>% 
  select( -RELTRAD, -CHRELTRAD, -CHFAMILY, -CHDENOM, -CHPROTFAM, -FAMILY, -PROTFAM, -DENOM, -WEIGHT, -resp,-...1,)


set.seed(123)  # for reproducibility
indices <- sample(1:nrow(data_clean_2014), size = 0.7 * nrow(data_clean_2014))
train_data <- data_clean_2014[indices, ]
test_data <- data_clean_2014[-indices, ]



rf_classifier <- randomForest(Religion_Change ~ ., data = train_data, ntree = 200)

# Making predictions
predictions <- predict(rf_classifier, test_data)

# Evaluate model performance
conf_matrix <- table(Predicted = predictions, Actual = test_data$Religion_Change)
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
print(paste("Accuracy: ", accuracy))


conf_matrix


#rain the Random Forest classifier using the training data. Assume that all other columns except your target variable (Religion_Change) are predictors.
```
<br>

The accuracy of your Random Forest model is approximately 75.05%, indicating that about three-quarters of the predictions made by the model are correct. The confusion matrix provides a more detailed breakdown of the model's performance:

- **True Positives (TP):** 1683 instances where the model correctly predicted 'Changed'.
- **True Negatives (TN):** 6173 instances where the model correctly predicted 'Same'.
- **False Positives (FP):** 597 instances where the model incorrectly predicted 'Changed' when the actual class was 'Same'.
- **False Negatives (FN):** 2014 instances where the model incorrectly predicted 'Same' when the actual class was 'Changed'.

<br>


```{r}
# Assuming 'rf' is your trained random forest model
importance_data <- importance(rf_classifier)
importance_df <- as.data.frame(importance_data)
importance_df$Feature <- rownames(importance_df)

# Using ggplot2 to create the importance plot with gradient color
p <- ggplot(importance_df, aes(x = reorder(Feature, MeanDecreaseGini), y = MeanDecreaseGini, fill = MeanDecreaseGini)) +
  geom_col() +  # Removing the specific fill color from geom_col
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +  # Define gradient from light blue to dodger blue
  coord_flip() +  # Flip coordinates for horizontal layout
  labs(title = "Feature Importance", x = "Features", y = "Increase in Node Purity") +
  theme_minimal()

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 1000)

# Show the interactive plot in your default browser

interactive_plot
```



<br>

In my analysis, numerous features significantly impact the classification results. However, for the next phase of the study, I aim to focus on features that offer clearer interpretability. Specifically, we plan to hone in on variables like income, education, age, political affiliation, marital status, self-reported happiness, and geographic location. These factors are not only straightforward to understand but also tend to have direct and tangible effects on individuals' life decisions and perspectives.

By narrowing our analysis to these interpretable factors, I hope to see how the results differ when we limit the model to variables that are more conceptually accessible and traditionally relevant in sociological research. Additionally, this approach will allow us to identify which of these easily understandable factors are most influential in predicting changes in religious affiliation, thereby enhancing the practical applicability and relevance of our findings.


<br>






```{r}
data_clean_2014 <- data_clean_2014 %>% 
  select(Religion_Change , agerec, income, educ, state, cregion, marital, qa1, qa2a, qa2b, qf2, attend)

# Renaming columns
data_clean_2014 <- data_clean_2014 %>%
  rename(
    
    religious_importance = qf2,
    happiness = qa1,
    family_life_satisfaction = qa2a,
    health_life_satisfaction = qa2b,

  )

set.seed(123)  # for reproducibility
indices <- sample(1:nrow(data_clean_2014), size = 0.7 * nrow(data_clean_2014))
train_data <- data_clean_2014[indices, ]
test_data <- data_clean_2014[-indices, ]

rf_classifier <- randomForest(Religion_Change ~ ., data = train_data, ntree = 200)

# Making predictions
predictions <- predict(rf_classifier, test_data)

# Evaluate model performance
conf_matrix <- table(Predicted = predictions, Actual = test_data$Religion_Change)
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
print(paste("Accuracy: ", accuracy))


conf_matrix
```
<br>

Even after reducing the dimensionality of our feature set to focus on 11 easily interpretable factors, the results remain quite comparable to the previous broader model. The accuracy of the current model stands at approximately 71.72%, only slightly lower than the earlier model's accuracy of 75.05%. This suggests that these selected interpretable factors—such as income, education, age, and others—still capture a significant portion of the variability needed to predict changes in religious affiliation effectively. This reduction in complexity, while maintaining a similar level of predictive power, underscores the relevance and robustness of these key factors in our analysis.

<br>

```{r}
# Assuming 'rf' is your trained random forest model
importance_data <- importance(rf_classifier)
importance_df <- as.data.frame(importance_data)
importance_df$Feature <- rownames(importance_df)

# Using ggplot2 to create the importance plot with gradient color
p <- ggplot(importance_df, aes(x = reorder(Feature, MeanDecreaseGini), y = MeanDecreaseGini, fill = MeanDecreaseGini)) +
  geom_col() +  # Removing the specific fill color from geom_col
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +  # Define gradient from light blue to dodger blue
  coord_flip() +  # Flip coordinates for horizontal layout
  labs(title = "Feature Importance", x = "Features", y = "Increase in Node Purity") +
  theme_minimal()

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 600)

# Show the interactive plot in your default browser

interactive_plot
```






<br>

1. **religious_importance (1565.3918)**: This is the most significant factor, indicating the personal significance of religion to an individual. A higher or lower value here directly impacts one's likelihood to maintain or change their religious affiliation, reflecting the core of how individuals perceive and prioritize their faith.

2. **state (1495.3427)**: The state where an individual resides is a crucial factor, likely due to the diverse religious landscapes across different states. This can influence exposure to various religious practices and communities, affecting personal religious changes.

3. **agerec (1269.5415)**: Age often correlates with changes in life perspective and priorities. As people age, their life experiences can lead to shifts in religious beliefs and practices, making this a key predictor of religious change.

4. **income (1213.9837)**: Financial status influences many aspects of a person's life, including the ability to participate in certain religious activities, exposure to diverse cultures, and general life satisfaction, all of which can affect religious affiliation.

5. **educ (979.5771)**: Educational attainment exposes individuals to various worldviews and critical thinking skills, which can lead to questioning and potentially changing religious beliefs.

6. **attend (876.4653)**: The frequency with which individuals attend religious services is both an indicator of current religious engagement and a predictor of future religious adherence or change.

7. **health_life_satisfaction (633.0054)**: How satisfied individuals are with their health can impact their spiritual beliefs, particularly as people often turn towards or away from spirituality in times of health crises.

8. **marital (646.6567)**: Changes in marital status can profoundly affect personal life, including religious practices and beliefs, as marriage can introduce new dynamics and influences regarding religion.

9. **happiness (552.6725)**: Overall happiness might influence how individuals feel about their current religious standings. Satisfied individuals might see no reason for change, whereas those less happy might seek new spiritual paths.

10. **cregion (469.2322)**: Similar to state, the broader cultural and regional setting can influence religious practices and changes, reflecting the social and cultural diversity impacting religious identity.

11. **family_life_satisfaction (435.1318)**: Satisfaction with family life can significantly influence religious stability or change. Family dynamics often play a crucial role in religious upbringing and continued practice.

These factors, listed by their importance, provide a comprehensive view of the determinants most predictive of changes in religious affiliation. Understanding these can help in developing targeted interventions, policies, and further research into the dynamics of religious identity.

<br>




#### GLM Model

<br>

In exploring factors that influence changes in religious beliefs, it's crucial to employ a statistical method that not only effectively handles binary outcomes but also provides interpretable results. This is where Generalized Linear Models (GLM) come into play, offering a robust framework for our analysis.

**Why GLM?** GLMs are particularly adept at modeling binary outcomes—such as whether an individual has changed their religious affiliation (Yes/No). This capability stems from the model's use of a logistic function, which naturally maps any input through predictors to a probability between 0 and 1, perfectly suiting binary classification tasks.

Additionally, GLMs bring a high level of interpretability to the table. Each predictor's effect is quantified with a coefficient that directly corresponds to the change in the log odds of the outcome per unit change in the predictor, holding all other predictors constant. This characteristic makes it easier to understand which factors are most influential in determining religious changes and allows these effects to be directly communicated in terms of odds ratios—a format that is intuitively understandable for both technical and non-technical audiences.

<br>



```{r}
# First make sure to use as.factor for catagorical predictors
data_clean_2014$religious_importance <- as.factor(data_clean_2014$religious_importance)
data_clean_2014$educ <- as.factor(data_clean_2014$educ)
data_clean_2014$income <- as.factor(data_clean_2014$income)  
data_clean_2014$marital <- as.factor(data_clean_2014$marital)
data_clean_2014$attend <- as.factor(data_clean_2014$attend)
data_clean_2014$agerec <- as.factor(data_clean_2014$agerec)



glm_model <- glm(Religion_Change ~ income + educ + agerec + marital + attend + religious_importance   , family = binomial(link = "logit"), data = data_clean_2014)

# Display the summary of the model
summary(glm_model)
```

<br>


##### Key Findings:

- **Significant Predictors**: Variables such as income levels (especially the lowest income bracket), educational attainment, age categories, marital status, frequency of attending religious services, and the importance placed on religion are significant predictors in your model. These factors exhibit a range of influences, with some increasing and others decreasing the likelihood of changing religious affiliation.
  
  For example:
  - Lower income and older age groups significantly predict changes in religious beliefs.
  - Higher levels of religious importance significantly decrease the likelihood of changing religious affiliation.


##### Visualization and Further Analysis:
To better understand the model performance and to ensure the robustness of the findings, consider visualizing the following:

- **Residual Plots**: Check residuals to assess any systematic deviations that could indicate model mis-specifications.
- **ROC Curve**: Generate an ROC curve to evaluate the diagnostic ability of the model across various classification thresholds.
- **Predicted vs. Actual**: Plotting predicted probabilities against actual outcomes can help visualize the model's accuracy in predicting changes in religious affiliation.

<br>


```{r}
# Extract residuals
residuals_data <- data.frame(Residuals = residuals(glm_model, type = "deviance"))

# For logistic regression, residuals won't be perfectly normal, but let's visualize:

ggplot(residuals_data, aes(x = seq_along(Residuals), y = Residuals)) +
  geom_point(alpha = 0.5) +
  labs(x = "Index", y = "Residuals", title = "Plot of Residuals") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))


```


```{r , warning=FALSE , message=FALSE}
p <- ggplot(residuals_data, aes(x = Residuals)) +
  geom_histogram(aes(y = ..density..), bins = 30, fill = "blue", alpha = 0.5) +
  geom_density(color = "red") +
  labs(x = "Residuals", y = "Density", title = "Histogram and Density Plot of Residuals") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 600)

# Show the interactive plot in your default browser
interactive_plot

```

<br>

These observations can inform us about the model fit. While a degree of asymmetry in residuals can be expected in logistic regression, significant deviations from the expected distribution may suggest model mis-specifications, non-linearity in the data that the model hasn't captured.

<br>

##### ROC curve

```{r, warning=FALSE}
# Assuming you have a binary outcome
probabilities <- predict(glm_model, type = "response")
roc_curve <- roc(response = data_clean_2014$Religion_Change, predictor = probabilities)

# Create a data frame for ggplot
roc_data <- data.frame(
  FPR = 1- roc_curve$specificities,
  TPR = roc_curve$sensitivities
)

# Plot ROC curve using ggplot2
 ggplot(roc_data, aes(x = FPR, y = TPR)) +
  geom_line(color = "darkorange") +
  geom_abline(linetype = "dashed") +
  labs(x = "False Positive Rate", y = "True Positive Rate", title = "ROC Curve") +
  theme_minimal() +
  geom_area(alpha = 0.2) +
  geom_segment(aes(x = 0, y = 0, xend = 1, yend = 1), color = "navy", linetype = "dashed") +
  annotate("text", x = 0.5, y = 0.25, label = paste("AUC =", round(auc(roc_curve), 2)), color = "red")


```
<br>

With an AUC of 0.73, the model has good predictive ability, significantly better than random guessing, which would have an AUC of 0.5. An AUC value in the range of 0.7 to 0.8 indicates that the model has a fair discrimination ability to differentiate between the two classes: those who have changed their religious affiliation and those who have not.

<br>

```{r}
# Create a dataframe for ggplot
predictions_data <- data.frame(
  Actual = data_clean_2014$Religion_Change,
  Predicted_Probability = probabilities
)

# Plot Predicted Probabilities vs Actual Outcomes
p <- ggplot(predictions_data, aes(x = Predicted_Probability, fill = Actual)) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 30) +
  labs(x = "Predicted Probability", y = "Count", title = "Predicted vs Actual Outcomes") +
  scale_fill_brewer(palette = "Set1", name = "Actual Outcome") +
  theme_minimal() +
  theme(legend.position = "bottom", plot.title = element_text(hjust = 0.5))

# Make it interactive
interactive_plot <- ggplotly(p , width = 1200 , height = 600)

# Show the interactive plot in your default browser
interactive_plot

```

<br>

The plot reveals that our model is more adept at predicting instances where individuals retain their childhood religious affiliation ('Same' class) than instances where they change their religious beliefs ('Changed' class). This discrepancy might stem from an imbalance in the dataset, where there are significantly more cases of one class compared to the other. As a result, the model may have learned the patterns associated with the 'Same' class more effectively because there were more examples to learn from, leading to a less robust understanding of the 'Changed' class characteristics. Addressing this imbalance could potentially improve the model's ability to discern the subtler patterns that indicate a shift in religious affiliation.

<br>



### Conclusion

In Chapter 4, I embarked on an analytical journey to model the dynamics of religious affiliation changes using a transition probability approach. Our exploration aimed to quantify how individuals transition between religious affiliations from childhood to adulthood and to simulate these changes over time within a societal context.

**Key Findings:**

- **Transition Probabilities:**  successfully quantified the probabilities of transitioning from one religious affiliation to another. The transition matrix constructed from these probabilities revealed detailed insights into the patterns of religious switching. Notably, significant transitions were observed towards non-affiliation ('Nothing in particular'), and there was an evident decline in traditional affiliations such as Protestantism and Catholicism.
  
- **Simulation Insights:** The simulation of religious composition over time highlighted potential trends and shifts in religious demographics. It demonstrated how the religious landscape could evolve, emphasizing the growing prevalence of religious non-affiliation alongside the decreasing proportions of established denominations.

- **Steady State Analysis:** Our analysis sought to determine if the distribution of religious affiliations would reach a steady state, where the proportions of each religion stabilize over time. The findings suggested that while some form of equilibrium could be anticipated, the religious landscape remains dynamically influenced by various social, cultural, and personal factors.

**Methodological Insights:**

- My methodology involved calculating transition probabilities and applying these to simulate the evolution of religious affiliations in a hypothetical population. This approach provided a framework for understanding the fluidity and changing nature of religious identities.
  
- The visualization techniques employed, including heatmaps of transition probabilities and time-series graphs of religious compositions, offered a clear and engaging representation of our findings, facilitating a deeper understanding of the underlying dynamics.

**Challenges and Limitations:**

- One of the primary challenges was the inherent data imbalance in religious affiliations, which influenced the model’s predictions and interpretations, particularly underrepresenting minority religious groups.
  
- Additionally, the model assumptions did not account for external factors such as immigration, birth, and death rates, which are crucial in real-world demographic studies. Future models would benefit from integrating these elements to provide more comprehensive insights.

**Implications and Future Directions:**

- The study's findings are crucial for policymakers, religious leaders, educators, and sociologists as they provide a quantified insight into how religious affiliations are changing over generations. This knowledge can help in crafting strategies that address the needs and preferences of diverse religious groups.

- Future research could expand upon this foundational work by incorporating more complex demographic models and exploring the impact of socio-political changes on religious affiliations. Further, qualitative studies could complement this quantitative analysis to delve deeper into the reasons behind religious switching.






## Refrences
To properly cite the 2014 and 2007 Pew Research Center datasets in APA format, you can structure your references like this:

### References

**For the 2014 Dataset:**

Pew Research Center. (2015). *America’s Changing Religious Landscape*. 
Retrieved from https://www.pewresearch.org/religion/2015/05/12/americas-changing-religious-landscape/

**For the 2007 Dataset:**

Pew Research Center. (2008). *U.S. Religious Landscape Survey: Religious Beliefs and Practices*. 
Retrieved from https://www.pewresearch.org/religion/2008/06/01/u-s-religious-landscape-survey-religious-beliefs-and-practices/









<!-- #### Motivation for Using Random Forest Regressor -->



<!-- <br> -->

<!-- ```{r} -->
<!-- # Include rpart library -->
<!-- library(rpart) -->

<!-- # Calculate the percentage of missing values for each column -->
<!-- missing_percentage <- sapply(survey_data_2007, function(x) sum(is.na(x)) / length(x)) * 100 -->

<!-- # Set threshold for removal -->
<!-- threshold <- 0 -->

<!-- # Find columns with missing value percentage greater than the threshold -->
<!-- columns_to_remove <- names(missing_percentage[missing_percentage > threshold]) -->

<!-- # Remove the columns from the dataset -->
<!-- data_clean <- survey_data_2007[, !(names(survey_data_2007) %in% columns_to_remove)] -->

<!-- # # Remove feature involved in Total Satisfaction measure -->
<!-- # data_clean <- select(data_clean,-q3a, -q3b, -q3c, -q3d, -q1, -q2, -q1_Score, -q2_Score) -->

<!-- data_clean <- data_clean %>% -->
<!--   select(Total_Satisfaction,marital,race,q16,q20,q21,q30,q35,q39a,q43a,age,sex,educ,income,family,ideo,state,party,usr,q60) -->


<!-- # Renaming columns -->
<!-- data_clean <- data_clean %>% -->
<!--   rename( -->
<!--     religion = q16, -->
<!--     attending = q20, -->
<!--     religious_importance = q21, -->
<!--     god_belief = q30, -->
<!--     heaven_belief = q35, -->
<!--     miracle = q39a, -->
<!--     spritual = q43a, -->
<!--     born_country = q60, -->
<!--     community_type = usr -->

<!--   ) -->



<!-- data_clean <- data_clean %>% -->
<!--   group_by(religion) %>%  -->
<!--   filter(n() > 100)  # Keep only religions with more than 100 respondents -->






<!-- set.seed(123) # Set seed for reproducibility -->
<!-- splitIndex <- sample(1:nrow(data_clean), size = round(0.7*nrow(data_clean))) -->
<!-- train_data <- data_clean[splitIndex,] -->
<!-- test_data <- data_clean[-splitIndex,] -->



<!-- # # Training the model -->
<!-- # tree_model <- rpart(Total_Satisfaction ~ ., data = train_data, method = "anova") -->

<!-- # Traning Model -->
<!-- rf <- randomForest(Total_Satisfaction ~ ., data = train_data, ntree = 100 , mtry = ncol(train_data) - 6, nodesize = 60) -->


<!-- print(rf) -->

<!-- predictions <- predict(rf, newdata = test_data) -->




<!-- ``` -->


<!-- # ```{r} -->
<!-- # # Assuming 'rf' is your trained randomForest model -->
<!-- # importance_measures <- importance(rf) -->
<!-- #  -->
<!-- # # Sort the importance measures by 'IncNodePurity' in descending order -->
<!-- # # Assuming 'IncNodePurity' is one of the columns in the returned matrix -->
<!-- # sorted_importance <- importance_measures[order(importance_measures[, "IncNodePurity"], decreasing = TRUE), ] -->
<!-- #  -->
<!-- # # View the sorted importance measures -->
<!-- # print(sorted_importance) -->
<!-- # ``` -->
<!-- <br> -->


<!-- #### Model Performance -->

<!-- 1. **Mean of Squared Residuals** -->
<!--    - `1.043743`: This is the average of the squared differences between the observed and predicted values. In the context of regression, a lower mean squared residual indicates better model performance. The interpretation of this value depends on the scale and variance of the `Total_Satisfaction` scores and should ideally be compared to other models or benchmarks for context. -->

<!-- 2. **% Var Explained** -->
<!--    - `16.39%`: This shows that the model explains 16.39% of the variance in the `Total_Satisfaction` data. While this might seem low, it's not uncommon in complex social science or human behavior data where many unobserved factors can influence outcomes. This percentage gives an idea of the predictive power of the model but also highlights the complexity and potentially high noise in the data. It suggests that while the model has some predictive capability, there's a lot of variability in satisfaction that is not captured by the available predictors. -->

<!-- <br> -->

<!-- #### Model Tuning -->


<!-- ```{r} -->

<!-- # Set up a train control function that defines how training is executed, including cross-validation settings -->
<!-- train_control <- trainControl( -->
<!--   method = "cv",   # Use k-fold cross-validation -->
<!--   number = 2,     # Number of folds in k-fold cross-validation -->
<!--   savePredictions = "final", -->
<!--   verboseIter = TRUE  # Print training iterations -->
<!-- ) -->

<!-- # Correct tuning grid: Only include mtry for the 'rf' method in caret -->
<!-- tune_grid <- expand.grid( -->
<!--   mtry = c( 5,8,10,14,16) -->
<!-- ) -->


<!-- #mtry <- sqrt(ncol(data_clean)) -->
<!-- #tunegrid <- expand.grid(.mtry=mtry) -->

<!-- # # Define the range of values for each parameter to tune: -->
<!-- # tune_grid <- expand.grid( -->
<!-- #   mtry <-  c( floor(ncol(train_data)/2), ncol(train_data)-6), -->
<!-- #   ntree = c(10, 50, 100), -->
<!-- #   nodesize = c(10, 20, 30, 40, 50) -->
<!-- #) -->

<!-- set.seed(123)  # for reproducibility -->
<!-- rf_tuned <- train( -->
<!--   Total_Satisfaction ~ .,  -->
<!--   data = train_data,  -->
<!--   method = "rf",  # Random Forest via caret's interface -->
<!--   trControl = train_control, -->
<!--   tuneGrid = tune_grid, -->
<!--   metric = "RMSE",  # Optimize for the lowest RMSE; change to "R2" if you prefer to maximize R squared -->
<!--   ntree = 50,  # Set a constant number of trees -->
<!--   nodesize = 50  # Set a constant node size -->
<!-- ) -->

<!-- print(rf_tuned) -->
<!-- plot(rf_tuned) -->


<!-- ``` -->








<!-- # ```{r} -->
<!-- #  -->
<!-- # # Assuming 'rf' is your trained random forest model -->
<!-- # importance_data <- importance(rf) -->
<!-- # importance_df <- as.data.frame(importance_data) -->
<!-- # importance_df$Feature <- rownames(importance_df) -->
<!-- #  -->
<!-- # # Using ggplot2 to create the importance plot with gradient color -->
<!-- # p <- ggplot(importance_df, aes(x = reorder(Feature, IncNodePurity), y = IncNodePurity, fill = IncNodePurity)) + -->
<!-- #   geom_col() +  # Removing the specific fill color from geom_col -->
<!-- #   scale_fill_gradient(low = "lightblue", high = "dodgerblue") +  # Define gradient from light blue to dodger blue -->
<!-- #   coord_flip() +  # Flip coordinates for horizontal layout -->
<!-- #   labs(title = "Feature Importance", x = "Features", y = "Increase in Node Purity") + -->
<!-- #   theme_minimal() -->
<!-- #  -->
<!-- # # Make it interactive -->
<!-- # interactive_plot <- ggplotly(p , width = 1200 , height = 600) -->
<!-- #  -->
<!-- # # Show the interactive plot in your default browser -->
<!-- #  -->
<!-- # interactive_plot -->
<!-- #  -->
<!-- #  -->
<!-- # ``` -->






<!-- <br> -->

<!-- #### Important Features Explanation -->

<!-- Having identified the important features through the Random Forest model, here is an explanation of these features and why they might be significant: -->

<!-- - **Party:** Political affiliation can significantly impact a person's perspectives, including their satisfaction levels, possibly reflecting differing life experiences and expectations. -->
<!-- - **Age:** Older or younger ages might reflect different satisfaction levels, due to varying life stages and challenges. -->
<!-- - **Income:** Financial status is a well-known determinant of satisfaction, influencing access to resources, security, and opportunities. -->
<!-- - **Marital Status:** Relationship status can affect personal satisfaction, with differences in emotional support and life satisfaction. -->
<!-- - **State:** Geographic location, represented here by state, can influence satisfaction due to economic, social, and cultural environments. -->
<!-- - **Family Religion:** The religious background of one's family might influence personal values and satisfaction through cultural and familial expectations. -->
<!-- - **Education (Educ):** Higher levels of education might correlate with different levels of satisfaction, potentially due to better job opportunities and socioeconomic status. -->
<!-- - **Ideology (Ideo):** Personal beliefs and ideologies can significantly influence one's satisfaction, aligning with individual values and perceptions. -->
<!-- - **Attending Religious Services (Attending):** Frequency of attending religious services could reflect deeper community ties or personal beliefs, affecting satisfaction. -->
<!-- - **Race:** Ethnic background can influence satisfaction levels due to societal structures, experiences, and opportunities. -->
<!-- - **Spiritual Beliefs (Spiritual), Religion, Miracles, Religious Importance, Heaven Belief:** Various aspects of religiosity and spirituality likely influence satisfaction by shaping worldview, coping mechanisms, and community engagement. -->
<!-- - **Community Type:** Urban, suburban, or rural settings might affect satisfaction levels due to differences in lifestyle, community closeness, and available amenities. -->
<!-- - **Sex:** Gender might influence satisfaction levels due to societal roles, expectations, and personal experiences. -->
<!-- - **Country of Birth (Born_Country), God Belief:** Cultural background and core beliefs can significantly impact overall life satisfaction. -->








<!-- #### Conclusion -->

<!-- In this section of our analysis, we explore the factors contributing to Total Satisfaction in individuals' lives. Interestingly, our findings indicate that the most significant predictors of satisfaction are not religious beliefs or spirituality, as one might expect, but rather income and age. This suggests that personal satisfaction is influenced not only by individual emotions and beliefs but also by broader social and economic factors. These can include one's job, educational background, and employment status—areas where religion typically does not play a direct role. -->

<!-- While religion can unite people and offer personal solace, our analysis shows that material conditions and life stages significantly impact overall satisfaction. This underscores the complexity of what drives human contentment, intertwining personal, social, and economic elements. -->

<!-- It is important to note that this does not diminish the value or role of religion in society; rather, it highlights that satisfaction is a multifaceted phenomenon influenced by various factors beyond spiritual beliefs. This study does not aim to critique or endorse any religious views but simply to present findings based on the data analyzed. -->

<!-- As this report is neutral and focused on data analysis, personal opinions on religion are set aside to maintain objectivity. Should you have any questions about this study or find any aspect particularly interesting, please feel free to reach out via email for further discussion or clarification. -->






